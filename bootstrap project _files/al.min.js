!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).augLoop=e()}}((function(){return function e(t,o,n){function r(i,a){if(!o[i]){if(!t[i]){var c="function"==typeof require&&require;if(!a&&c)return c(i,!0);if(s)return s(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var l=o[i]={exports:{}};t[i][0].call(l.exports,(function(e){var o=t[i][1][e];return r(o||e)}),l,l.exports,e,t,o,n)}return o[i].exports}for(var s="function"==typeof require&&require,i=0;i<n.length;i++)r(n[i]);return r}({"@ms/office-online-telemetry":[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n={getUlsLogger:!0};Object.defineProperty(o,"getUlsLogger",{enumerable:!0,get:function(){return a.getUlsLogger}});var r=e("./externalLogger");Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||Object.defineProperty(o,e,{enumerable:!0,get:function(){return r[e]}}))}));var s=e("./buls/LogCategory");Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||Object.defineProperty(o,e,{enumerable:!0,get:function(){return s[e]}}))}));var i=e("./buls/TraceLevel");Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||Object.defineProperty(o,e,{enumerable:!0,get:function(){return i[e]}}))}));var a=e("./buls/bUls"),c=e("./UnitTestLogger");Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||Object.defineProperty(o,e,{enumerable:!0,get:function(){return c[e]}}))}));var u=e("./ConsoleLogger");Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||Object.defineProperty(o,e,{enumerable:!0,get:function(){return u[e]}}))}))},{"./ConsoleLogger":79,"./UnitTestLogger":80,"./buls/LogCategory":81,"./buls/TraceLevel":83,"./buls/bUls":84,"./externalLogger":88}],1:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.ExcelSessionCloseReason=o.ExcelKeepAlive=o.ExcelAccessTokenRefreshed=o.ExcelWorkbookUpdated=o.ExcelServerSessionExtensionConfig=o.ExcelServerSessionInitMessage=void 0;var n=e("@augloop/types-core"),r=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelServerSessionInitMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_SessionInitMessage","AugLoop_Session_Protocol_Message"]},e}();o.ExcelServerSessionInitMessage=r;var s=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelServerSessionExtensionConfig"},e.getBaseTypes=function(){return[]},e}();o.ExcelServerSessionExtensionConfig=s;var i=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelWorkbookUpdated"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e}();o.ExcelWorkbookUpdated=i;var a=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelAccessTokenRefreshed"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e}();o.ExcelAccessTokenRefreshed=a;var c=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelKeepAlive"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e}();o.ExcelKeepAlive=c;var u=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelSessionCloseReason"},e.getBaseTypes=function(){return[]},e}();o.ExcelSessionCloseReason=u},{"@augloop/types-core":77}],2:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.arrayOperators=void 0,function(e){e.some="some",e.every="every",e.none="none"}(o.arrayOperators||(o.arrayOperators={}))},{}],3:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.comparisonOperators=void 0,function(e){e.eq="eq",e.ne="ne",e.ge="ge",e.gt="gt",e.lt="lt",e.le="le"}(o.comparisonOperators||(o.comparisonOperators={}))},{}],4:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.EnvironmentNameTranslation=o.Environment=void 0,function(e){e.dev="dev",e.int="int",e.test="test",e.dogfood="dogfood",e.prod="prod",e.gcc="gcc",e.dod="dod",e.gccHigh="gcchigh"}(o.Environment||(o.Environment={})),o.EnvironmentNameTranslation={gcc:"fairfax"}},{}],5:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.isLogicalCondition=o.isComparisonCondition=o.isArrayCondition=void 0;var n=e("./array-operators"),r=e("./comparison-operators"),s=e("./logical-operators");o.isArrayCondition=function(e){return e.operator in n.arrayOperators},o.isComparisonCondition=function(e){return e.operator in r.comparisonOperators},o.isLogicalCondition=function(e){return e.operator in s.logicalOperators}},{"./array-operators":2,"./comparison-operators":3,"./logical-operators":13}],6:[function(e,t,o){"use strict";var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var n=Array(e),r=0;for(t=0;t<o;t++)for(var s=arguments[t],i=0,a=s.length;i<a;i++,r++)n[r]=s[i];return n};Object.defineProperty(o,"__esModule",{value:!0}),o.getTypesFromLambdas=o.functionReviver=o.functionReplacer=void 0;var r=function(e,t,o){var r=this;this.reviver=function(e,t){if("string"==typeof t){var o=t.match(/function[^\(]*\(([^\)]*)\)\s*{([\w\W]*?)}$/)||t.match(/\(([^\)]*)\)\s*=>\s*{([\w\W]*?)}$/);if(o){var s=o[1].split(",").map((function(e){return e.replace(/\s+/,"")})),i=r.functionName?o[2].concat("//# sourceURL="+r.functionName+".js"):o[2];return r.debuggable&&(i="debugger;".concat(i)),r.dependencyArguments&&(s=s.concat(Array.from(r.dependencyArguments))),Function.apply(void 0,n(s,[i]))}}return t},this.functionName=e,this.debuggable=o,this.dependencyArguments=t};o.functionReplacer=function(e,t){return"function"==typeof t?t.toString():t},o.functionReviver=function(e,t,o){return void 0===t&&(t=null),void 0===o&&(o=!1),new r(e,t,o).reviver},o.getTypesFromLambdas=function(e){for(var t=[],o=0,n=e;o<n.length;o++){var r=n[o];r.inputSchema&&t.push(r.inputSchema),r.outputSchema&&t.push(r.outputSchema),r.configSchema&&t.push(r.configSchema)}return t}},{}],7:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.LoggingLevel=void 0,function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.info=3]="info",e[e.metric=4]="metric",e[e.verbose=5]="verbose",e[e.debug=6]="debug"}(o.LoggingLevel||(o.LoggingLevel={}))},{}],8:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.isStopWorkflowMessage=o.setStopAndFilterWorkflowMessage=o.isExceptionMessage=o.setMessageException=o.getMessageExceptionType=o.getMessageExceptionDescription=o.filterWorkflowSchema=o.exceptionSchema=void 0;var n=e("@augloop/schemas/dist/src/client/schemas");o.exceptionSchema={category:n.TypeCategory.Schema,schema:{name:"Exception",path:"message-schema.proto"}},o.filterWorkflowSchema={category:n.TypeCategory.Schema,schema:{name:"Filter",path:"message-schema.proto"}},o.getMessageExceptionDescription=function(e,t){if(void 0===t&&(t=!1),null==e)return"Invalid message passed";if(null==e.payload)return n.ExceptionType[n.ExceptionType.NoOutput]+": Payload is null";if(null==e.payload.exceptionType)return"Payload is not an exception";var o=n.ExceptionType[e.payload.exceptionType];return o+=e.payload.message?": "+e.payload.message:": No description",o+=t&&e.payload.data?"\n"+e.payload.data.toString():""},o.getMessageExceptionType=function(e){return null==e||null==e.payload||null==e.payload.exceptionType?n.ExceptionType.Unknown:e.payload.exceptionType},o.setMessageException=function(e,t){if(null==e)throw new Error("Cannot set exception on null message");e.payload=t,e.payloadSchema=o.exceptionSchema,e.messageType=n.MessageType.Exception},o.isExceptionMessage=function(e){return null==e||null==e.messageType||e.messageType==n.MessageType.Exception},o.setStopAndFilterWorkflowMessage=function(e,t){if(null==e)throw new Error("Cannot set filter on null message");var r={condition:t};e.payload=r,e.payloadSchema=o.filterWorkflowSchema,e.messageType=n.MessageType.StopAndFilterWorkflow},o.isStopWorkflowMessage=function(e){return(e||{}).messageType==n.MessageType.StopAndFilterWorkflow}},{"@augloop/schemas/dist/src/client/schemas":57}],9:[function(e,t,o){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||t.hasOwnProperty(o)||n(t,e,o)};Object.defineProperty(o,"__esModule",{value:!0}),r(e("./array-operators"),o),r(e("./comparison-operators"),o),r(e("./ifilterconditions"),o),r(e("./ilambda"),o),r(e("./iLambdaConfigRegistry"),o),r(e("./ilogger"),o),r(e("./imessage"),o),r(e("./ipubsub"),o),r(e("./ityperegistry"),o),r(e("./lambda-type"),o),r(e("./logical-operators"),o)},{"./array-operators":2,"./comparison-operators":3,"./iLambdaConfigRegistry":4,"./ifilterconditions":5,"./ilambda":6,"./ilogger":7,"./imessage":8,"./ipubsub":10,"./ityperegistry":11,"./lambda-type":12,"./logical-operators":13}],10:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.SerializationProfile=o.Pattern=void 0,function(e){e[e.PubSub=0]="PubSub",e[e.RequestReply=1]="RequestReply"}(o.Pattern||(o.Pattern={})),function(e){e[e.JSONB=0]="JSONB",e[e.JSON=1]="JSON",e[e.JSOND=2]="JSOND",e[e.Disabled=3]="Disabled",e[e.COMPRESSEDJSON=4]="COMPRESSEDJSON"}(o.SerializationProfile||(o.SerializationProfile={}))},{}],11:[function(e,t,o){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(o,"__esModule",{value:!0}),o.elementTypeFrom=o.arrayTypeFrom=o.isArrayType=o.schemaRefToString=o.typeToString=o.areTypesEqual=o.isTypePrimitive=o.MessageSchema=o.TypeSchema=o.FunctionType=o.BufferType=o.StringType=o.NumberType=o.BooleanType=o.UndefinedType=void 0;var r=e("@augloop/schemas/dist/src/client/schemas");o.UndefinedType={category:r.TypeCategory.Undefined},o.BooleanType={category:r.TypeCategory.Boolean},o.NumberType={category:r.TypeCategory.Number},o.StringType={category:r.TypeCategory.String},o.BufferType={category:r.TypeCategory.Buffer},o.FunctionType={category:r.TypeCategory.Function},o.TypeSchema={category:r.TypeCategory.Schema,schema:{name:"Type",path:"type-schema.proto"}},o.MessageSchema={category:r.TypeCategory.Schema,schema:{name:"BufferMessage",path:"message-schema.proto"}},o.isTypePrimitive=function(e){if(null==e)return!1;switch(e.category){case r.TypeCategory.Boolean:case r.TypeCategory.Number:case r.TypeCategory.String:return!0;default:return!1}};o.areTypesEqual=function(e,t){return o.typeToString(e)===o.typeToString(t)},o.typeToString=function(e){if(void 0===e)return"";if(null===e)return"null";var t,o=Object.keys(e).sort().map((function(t){return i(t,e[t])})).filter((function(e){return!!e}));return t="{".concat(o.join(",")).concat("}"),Number(t),t};var s=function(e){if(void 0===e)return"";if(null===e)return"null";var t=Object.keys(e).sort().map((function(t){return i(t,e[t])})).filter((function(e){return!!e}));return"{".concat(t.join(",")).concat("}")},i=function(e,t){return"schema"===e?'"'+e+'":'+s(t):"path"===e?"":"nestedArrayLevel"===e?t?'"'+e+'":'+t:"":void 0===t?"":"string"==typeof t?'"'+e+'":"'+t+'"':'"'+e+'":'+t};o.schemaRefToString=s,o.isArrayType=function(e){return!!e&&e.nestedArrayLevel>0},o.arrayTypeFrom=function(e){var t=n({},e);return t.nestedArrayLevel=o.isArrayType(e)?e.nestedArrayLevel+1:1,t},o.elementTypeFrom=function(e){var t=n({},e);return t.nestedArrayLevel=o.isArrayType(e)?e.nestedArrayLevel-1:0,t}},{"@augloop/schemas/dist/src/client/schemas":57}],12:[function(e,t,o){"use strict";var n;Object.defineProperty(o,"__esModule",{value:!0}),o.gatewayType=o.matchmakerType=o.executeOnStopWorkflow=o.isBuiltInLambda=o.BuiltInLambdaType=void 0,function(e){e.Expression="Expression",e.MessageOutput="MessageOutput",e.Edge="Edge",e.EnterWorkflow="EnterWorkflow",e.ExitWorkflow="ExitWorkflow",e.Join="Join",e.SerializePayload="SerializePayload",e.DeserializePayload="DeserializePayload",e.Inline="Inline"}(n=o.BuiltInLambdaType||(o.BuiltInLambdaType={})),o.isBuiltInLambda=function(e){return!!n[e]},o.executeOnStopWorkflow=function(e){return o.isBuiltInLambda(e)&&e!=n.Inline||e==o.matchmakerType},o.matchmakerType="Matchmaker",o.gatewayType="Gateway"},{}],13:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.logicalOperators=void 0,function(e){e.All="All",e.Any="Any"}(o.logicalOperators||(o.logicalOperators={}))},{}],14:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=e("./jsond");Object.defineProperty(o,"JSOND",{enumerable:!0,get:function(){return n.JSOND}})},{"./jsond":15}],15:[function(e,t,o){"use strict";var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,o=t&&e[t],n=0;if(o)return o.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(o,"__esModule",{value:!0}),o.JSOND=void 0,e("fast-text-encoding");var r=function(){function e(){}return e.deserialize=function(t,o){if(void 0===o&&(o=function(e){return e}),t[0]!==e.IDENTIFIERBYTE)throw"Invalid Binary: Incorrect Identifier";for(var n=1,r=[],s=new DataView(t.buffer,t.byteOffset,t.byteLength);n<t.byteLength;){if(n+4>t.byteLength)throw"Invalid Binary: Error reading fragment length";var i=s.getUint32(n);if(n+i+4>t.byteLength)throw"Invalid Binary: Fragment out of range";"undefined"!=typeof Buffer&&Buffer.from?r.push(Buffer.from(t.buffer,t.byteOffset+n+4,i)):r.push(new Uint8Array(t.buffer,t.byteOffset+n+4,i)),n+=4+i}if(r.length<1)throw"Invalid Binary: No fragments found";var a=e.textDecoder.decode(r[0]);return JSON.parse(a,(function(t,n){if("string"==typeof n){if(n.substring(0,e.BINARYKEYWORD.length)===e.BINARYKEYWORD){var s=parseInt(n.substring(e.BINARYKEYWORD.length),10);if("number"!=typeof s||s>=r.length-1)throw"Invalid Binary: Binary index out of range";return o(r[s+1])}if(n.substring(0,e.ESCAPEKEYWORD.length)===e.ESCAPEKEYWORD)return n.substring(e.ESCAPEKEYWORD.length)}return n}))},e.serialize=function(t){var o,r,s=[void 0],i=JSON.stringify(t,(function(t,o){return ArrayBuffer.isView(o)?(s.push(o),""+e.BINARYKEYWORD+(s.length-2)):o&&"Buffer"===o.type&&Array.isArray(o.data)?(s.push(new Uint8Array(o.data)),""+e.BINARYKEYWORD+(s.length-2)):"string"==typeof o&&o.substring(0,e.ESCAPEKEYWORD.length)===e.ESCAPEKEYWORD?e.ESCAPEKEYWORD+o:o}));s[0]=e.textEncoder.encode(i);var a=s.reduce((function(e,t){return e+4+t.byteLength}),0),c=new Uint8Array(a+1);c[0]=e.IDENTIFIERBYTE;var u=1,l=new DataView(c.buffer,c.byteOffset,c.byteLength);try{for(var p=n(s),g=p.next();!g.done;g=p.next()){var f=g.value;l.setUint32(u,f.byteLength),c.set(f,u+4),u+=4+f.byteLength}}catch(e){o={error:e}}finally{try{g&&!g.done&&(r=p.return)&&r.call(p)}finally{if(o)throw o.error}}return c},e.IDENTIFIERBYTE=3,e.BINARYKEYWORD=":b",e.ESCAPEKEYWORD=":",e.textDecoder=new TextDecoder,e.textEncoder=new TextEncoder,e}();o.JSOND=r},{"fast-text-encoding":93}],16:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=e("../correlation-vector");Object.defineProperty(o,"CorrelationVector",{enumerable:!0,get:function(){return n.CorrelationVector}});var r=e("../logging");Object.defineProperty(o,"Log",{enumerable:!0,get:function(){return r.Log}}),Object.defineProperty(o,"LogCategory",{enumerable:!0,get:function(){return r.LogCategory}});var s=e("../logging-aggregator");Object.defineProperty(o,"LoggingAggregator",{enumerable:!0,get:function(){return s.LoggingAggregator}});var i=e("../operation");Object.defineProperty(o,"Operation",{enumerable:!0,get:function(){return i.Operation}})},{"../correlation-vector":17,"../logging":19,"../logging-aggregator":18,"../operation":21}],17:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.CorrelationVector=void 0;var n=function(){function e(e){this.childCount=0,this.id=e||function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=[],o=0;o<22;o++)t.push(e.charAt(Math.floor(Math.random()*e.length)));return t.join("")}()}return e.fromString=function(t,o){if(!t)throw new Error("Received invalid correlation vector string");var n;return n=t.endsWith(".0")?new e(t.substring(0,t.length-2)):new e(t),o&&(n.childCount=o),n},e.prototype.newChild=function(){return++this.childCount,new e(this.id+"."+this.childCount.toString())},e.prototype.toString=function(){return this.id.length>127?this.id.substr(0,127)+"!":this.id},e}();o.CorrelationVector=n},{}],18:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.LoggingAggregator=void 0;var n=/\|\~/g,r=function(){this.count=0,this.measureSums=new Map},s=function(e,t,o,s,i){var a=this;this.buckets=new Map,this.init=function(e){a.log=e},this.add=function(e){if(a.condition&&a.condition(e)){for(var t=[],o=0,s=a.dimensions;o<s.length;o++){var i=s[o];if(void 0===e[i])t.push(null);else{var c="";"boolean"==typeof e[i]?c="b~":"number"==typeof e[i]&&(c="n~"),t.push(""+c+e[i].toString().replace(n,"_"))}}var u=t.join("|"),l=a.buckets.get(u);if(!l){(l=new r).traceLevel=e.traceLevel;for(var p=0,g=a.avgMeasures;p<g.length;p++){var f=g[p];l.measureSums.set(f,0)}a.buckets.set(u,l)}l.count++;for(var h=0,d=a.avgMeasures;h<d.length;h++)e[f=d[h]]&&l.measureSums.set(f,l.measureSums.get(f)+e[f])}else a.log(e,!1)},this.flush=function(e){void 0===e&&(e=!1),a.buckets.forEach((function(e,t){for(var o={traceLevel:e.traceLevel,eventName:a.eventName,count:e.count},n=t.split("|"),r=0;r<a.dimensions.length;r++){var s=a.dimensions[r],i=n[r];0===i.indexOf("b~")?o[s]="b~true"===i:0===i.indexOf("n~")?o[s]=parseInt(i.slice("n~".length),10):o[s]=i}for(var c=0,u=a.avgMeasures;c<u.length;c++){var l=u[c];o[l]=Math.round(e.measureSums.get(l)/e.count)}a.log(o,!0)})),a.buckets.clear(),e&&(a.condition=null,clearInterval(a.interval))},this.eventName=e,this.condition=t,this.dimensions=o,this.avgMeasures=s,i>0&&(this.interval=setInterval(this.flush,1e3*i))};o.LoggingAggregator=s},{}],19:[function(e,t,o){(function(t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.LogCategory=o.Log=void 0;var n,r,s=e("@augloop/interfaces"),i=e("fast-json-stable-stringify"),a=void 0!==t&&t.env?t.env.SERVICE_NAME:"client",c="abcdefghijklmnopqrstuvwxyz0123456789",u={97:0,98:1,99:2,100:3,101:4,102:5,103:6,104:7,105:8,106:9,107:10,108:11,109:12,110:13,111:14,112:15,113:16,114:17,115:18,116:19,117:20,118:21,119:22,120:23,121:24,122:25,48:26,49:27,50:28,51:29,52:30,53:31,54:32,55:33,56:34,57:35},l=[],p=new Map,g=new Map,f=new Map;!function(e){e.defineCoreLogCategory=function(e){return{root:"Core",name:e}},e.defineWorkflowLogCategory=function(e){return{root:"Workflow",name:e}},e.clearLoggers=function(){l=[],g.clear()},e.addLogger=function(e){l.push(e),Object.keys(s.LoggingLevel).map((function(e){return s.LoggingLevel[e]})).filter((function(t){return t<=e.level})).forEach((function(t){g.has(t)?g.get(t).push(e):g.set(t,[e])}))},e.setCorrelationContextCallback=function(e){n=e},e.addAggregator=function(e){e.init((function(e,t){y(e,t)})),p.set(e.eventName,e)},e.flushAggregators=function(e){p.forEach((function(t){t.flush(e)}))},e.setTagLevelOverride=function(e,t){var o=b(e);f.set(o,t)},e.resetTagLevelOverrides=function(){f.clear()},e.error=function(e,t){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];m(e,t,s.LoggingLevel.error,o)},e.warn=function(e,t){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];m(e,t,s.LoggingLevel.warn,o)},e.info=function(e,t){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];m(e,t,s.LoggingLevel.info,o)},e.verbose=function(e,t){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];m(e,t,s.LoggingLevel.verbose,o)},e.debug=function(e,t){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];m(e,t,s.LoggingLevel.debug,o)},e.metric=function(e,t){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];m(e,t,s.LoggingLevel.metric,o)},e.dynamic=function(e){y(e)}}(r=o.Log||(o.Log={}));var h=function(e){return e.map((function(e){return e instanceof Error?i({message:e.message,name:e.name,stack:e.stack}):"object"==typeof e?i(e):e})).join(" ")},d=function(e){return void 0!==e?g.get(e)||[]:l},m=function(e,t,o,n){o=f.get(e)||o;var r=d(o);if(0!=r.length){var s=v(e),i=function(e){return e.map((function(e){return"function"==typeof e?e():e}))}(n);if(1==i.length&&"object"==typeof i[0]){var a=i[0];a.tagId=s,"Operation"===a.eventName&&"Workflow"===t.root&&(a.eventName="WorkflowOperation"),a.traceLevel=o;var c=p.get(a.eventName);c?c.add(a):y(a,!1,r)}else y({eventName:"Log",tagId:s,category:t.root+"."+t.name,traceLevel:o,message:h(i)},!1,r)}},y=function(e,t,o){var r,s;if(void 0===t&&(t=!1),null==o&&(o=d(e.traceLevel)),o.length>0){if(e.serviceName=a,!t&&n){var i=n();if(i){e.cv=e.cv?e.cv:i.cv.toString(),e.sessionKey=e.sessionKey?e.sessionKey:i.sessionKey;var c=null===(r=i.clientMetadata)||void 0===r?void 0:r.appName;e.clientAppName=e.clientAppName?e.clientAppName:c;var u=null===(s=i.clientMetadata)||void 0===s?void 0:s.appPlatform;e.clientAppPlatform=e.clientAppPlatform?e.clientAppPlatform:u}}for(var l=0,p=o;l<p.length;l++){p[l].log(e)}}},v=function(e){return c[e>>24&63]+c[e>>18&63]+c[e>>12&63]+c[e>>6&63]+c[e>>0&63]},b=function(e){return e&&5===e.length?u[e.charCodeAt(0)]<<24|u[e.charCodeAt(1)]<<18|u[e.charCodeAt(2)]<<12|u[e.charCodeAt(3)]<<6|u[e.charCodeAt(4)]:-1},S=function(){function e(){}return e.CoreDefault=r.defineCoreLogCategory("Default"),e.WorkflowDefault=r.defineWorkflowLogCategory("Default"),e}();o.LogCategory=S}).call(this,e("_process"))},{"@augloop/interfaces":9,_process:95,"fast-json-stable-stringify":92}],20:[function(e,t,o){(function(e){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.now=void 0;o.now=void 0!==e&&e.hrtime?function(){var t=e.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return Date.now()}}).call(this,e("_process"))},{_process:95}],21:[function(e,t,o){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.Operation=void 0;var s=e("@augloop/tracelogger/dist/src/operation-event"),i=e("./now"),a=function(e){function t(t,o){var n=e.call(this,t)||this;return n.eventName="Operation",t&&null!=t.count||(n.count=1),o&&n.setClientMetadata(o),n}return r(t,e),t.prototype.setClientMetadata=function(e){e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,this.clientFlights=e.flights,this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId)},t.prototype.start=function(){return this.startTime=i.now(),this},t.prototype.stop=function(){var e=i.now();return this.durationMs=Math.round(e-this.startTime),this},t}(s.OperationEvent);o.Operation=a},{"./now":20,"@augloop/tracelogger/dist/src/operation-event":70}],22:[function(e,t,o){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.SessionHealth=o.SessionHealthImpact=o.SessionHealthReason=o.SessionHealthSource=void 0;var s,i,a,c=e("@augloop/tracelogger/dist/src/session-health-event"),u=e("./now");!function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.ClientRuntime=5]="ClientRuntime"}(s=o.SessionHealthSource||(o.SessionHealthSource={})),function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.Network=5]="Network",e[e.AugLoopDependency=6]="AugLoopDependency",e[e.WorkflowDependency=7]="WorkflowDependency",e[e.ClientRuntime=8]="ClientRuntime"}(i=o.SessionHealthReason||(o.SessionHealthReason={})),function(e){e[e.Unknown=0]="Unknown",e[e.None=1]="None",e[e.MissingInput=2]="MissingInput",e[e.MissingOutput=3]="MissingOutput"}(a=o.SessionHealthImpact||(o.SessionHealthImpact={}));var l=function(e){function t(t,o){var n,r,c=e.call(this,{source:s[t.source],reason:i[t.reason],reasonDependency:t.reasonDependency,sessionHealthEventName:t.sessionHealthEventName,impact:a[t.impact],success:t.success,durationMs:null!==(n=t.durationMs)&&void 0!==n?n:0,count:"number"==typeof t.count?t.count:1,message:t.message,affectedWorkflows:(null!==(r=t.affectedWorkflows)&&void 0!==r?r:[]).join(","),resourceId:t.resourceId,dimension0:t.dimension0,dimension1:t.dimension1,dimension2:t.dimension2,dimension3:t.dimension3,cv:t.cv,resultSignature:t.resultSignature,resultDescription:t.resultDescription})||this;return c.eventName="SessionHealth",o&&c.setClientMetadata(o),c}return r(t,e),t.prototype.setClientMetadata=function(e){return e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,this.clientFlights=e.flights,this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId),this},t.prototype.setReason=function(e){return this.reason=i[e],this},t.prototype.setSource=function(e){return this.source=s[e],this},t.prototype.setImpact=function(e){return this.impact=a[e],this},t.prototype.setAffectedWorkflows=function(e){return this.affectedWorkflows=(null!=e?e:[]).join(","),this},t.prototype.getAffectedWorkflows=function(){return this.affectedWorkflows.split(",")},t.prototype.start=function(){return this.startTime=u.now(),this},t.prototype.stop=function(){var e=u.now();return this.durationMs=Math.round(e-this.startTime),this},t}(c.SessionHealthEvent);o.SessionHealth=l},{"./now":20,"@augloop/tracelogger/dist/src/session-health-event":71}],23:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.ALFactoryGlobal=o.AugLoopFactory=void 0;var n=e("./AugLoopRuntimeManager"),r=function(){function e(){this._augLoopRuntimeManager=new n.AugLoopRuntimeManager}return e.prototype.getAugLoopRuntimeManager=function(){return this._augLoopRuntimeManager},e}();o.AugLoopFactory=r,o.ALFactoryGlobal=new r},{"./AugLoopRuntimeManager":24}],24:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.AugLoopRuntimeManager=o.IdentityProvider=void 0;var n=e("@augloop/runtime-client"),r=e("@augloop/schemas/dist/src/client/schemas");Object.defineProperty(o,"IdentityProvider",{enumerable:!0,get:function(){return r.IdentityProvider}});var s=e("@ms/office-online-telemetry/lib/index"),i=e("@augloop/excel-session-protocol/dist/src/generated/messages.g"),a=e("@augloop/powerpoint-session-protocol/dist/src/generated/messages.g"),c=function(e,t){for(var o,n=[],r=0,i=Object.keys(e);r<i.length;r++){var a=i[r];if(void 0!==e[a]&&null!==e[a]){var c={name:t?t+"."+a:a,dataType:(o=e[a],"string"==typeof o?0:"boolean"==typeof o?1:"number"==typeof o?2:void s.ULS.sendTraceTag(594925020,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Warning,"Unsupported data field type")),value:e[a],classification:4};n.push(c)}}return n},u=function(e,t,o,n){return Promise.resolve(null)},l=function(e){return Promise.resolve(!1)},p=function(){function e(){var e=this;this._telemetryAggregationIntervalSec=30,this._eventHandlerDictionary={},this.initialize=function(t){if(e._runtimeInitPromise)s.ULS.sendTraceTag(594921239,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Info,"Runtime already initialized");else if(s.ULS.sendTraceTag(595646411,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Info,"Start and initialize augloop runtime ..."),null!=t){var o=t.serviceUrl,r=t.appName,i=t.appVersion,a=t.uiLanguage,c=t.releaseAudienceGroup,p=t.releaseChannel,g=t.releaseFork,f=t.sessionId,h=t.initSession,d=t.flights,m=t.privateMode,y=t.disabledServiceGroups;e.excelServerParameters=t.excelServer,e.powerpointParameters=t.powerpoint;var v={appName:r,appPlatform:"Web",appVersion:i,uiLanguage:a,releaseAudienceGroup:c,releaseChannel:p,releaseFork:g,sessionId:f,flights:d,privateMode:m,disabledServiceGroups:y},b={onResult:e.onResult.bind(e),onAnnotationResult:e.onAnnotationResult.bind(e),sendTelemetryEvent:e.sendTelemetryEvent.bind(e),requestAuthToken:e.requestAuthToken.bind(e),isFeatureEnabled:e.isFeatureEnabled.bind(e),executeLocalLambda:u,setSessionData:e.setSessionData.bind(e),areLicenseFeaturesEnabled:l,onInitSession:e.onInitSession.bind(e),overrideSessionInitMessage:e.overrideSessionInitMessage.bind(e)};e._runtimeInitPromise=n.runtime.init(o,v,b,{telemetryAggregationIntervalSec:e._telemetryAggregationIntervalSec,initSession:!!h})}else s.ULS.sendTraceTag(595646412,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"initialize failed due to null parameters")},this.setULSLogger=function(e){if(null!=e){var t=e.ulsLogger;null!=t&&s.ULS.setLogger(t)}else s.ULS.sendTraceTag(595646413,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"setULSLogger failed due to null parameters")},this.setSendOTelEventCallback=function(t){if(null!=t){var o=t.sendOTelEvent;e._sendOTelEventCallback=o}else s.ULS.sendTraceTag(595642576,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"setSendOTelEventCallback failed due to null parameters")},this.setRequestAuthTokenCallback=function(t){if(null!=t){var o=t.requestAuthTokenCallback;e._requestAuthTokenCallback=o}else s.ULS.sendTraceTag(595646414,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"setRequestAuthTokenCallback failed due to null parameters")},this.setIsFeatureEnabledCallback=function(t){if(null!=t){var o=t.featureEnabledCallback;e._featureEnabledCallback=o}else s.ULS.sendTraceTag(595646415,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"setIsFeatureEnabledCallback failed due to null parameters")},this.activateAnnotation=function(t){return t&&t.annotationType?e._runtimeInitPromise?e._runtimeInitPromise.then((function(){var e=void 0;return t.handler&&(e={callback:t.handler}),n.runtime.activateAnnotation(t.annotationType,e)})):Promise.reject(new Error("Called before initialize")):Promise.reject(new Error("Invalid parameters"))},this.releaseAnnotation=function(t){return t&&t.token?e._runtimeInitPromise?e._runtimeInitPromise.then((function(){return n.runtime.releaseAnnotation(t.token)})):Promise.reject(new Error("Called before initialize")):Promise.reject(new Error("Invalid parameters"))},this.submitOperation=function(t){if(null!=t){var o=t.operation;o?e._runtimeInitPromise?e._runtimeInitPromise.then((function(){n.runtime.submitOperation(o)})):s.ULS.sendTraceTag(595646418,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"submitOperation called before initialize"):s.ULS.sendTraceTag(595646417,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"Operation was null")}else s.ULS.sendTraceTag(595646416,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"submitOperation failed due to null parameters")},this.setSessionDataCallback=function(t){if(null!=t){var o=t.handler,n=t.sessionDataCallback;n?e._setSessionDataCallback=n:o&&(e._setSessionDataCallback=function(e,t,n){return o(e,t)})}else s.ULS.sendTraceTag(595646419,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"setSessionDataCallback failed due to null parameters")},this.setAnnotationResultCallback=function(t){if(null!=t){var o=t.handler;e._annotationResultCallback=o}else s.ULS.sendTraceTag(595646420,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"setAnnotationResultCallback failed due to null parameters")},this.setAnnotationState=function(t){null==t?s.ULS.sendTraceTag(595646421,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"setAnnotationState failed due to null parameters"):e._runtimeInitPromise.then((function(){n.runtime.setAnnotationState(t.parentPath,t.id,t.value)}))},this.setInitSessionCallback=function(t){if(t){var o=t.initSessionCallback;e._initSessionCallback=o}else s.ULS.sendTraceTag(595076613,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"setInitSessionCallback failed due to null parameters")},this.setSessionInitOverrideCallback=function(t){if(t){var o=t.handler;e._sessionInitOverrideCallback=o}else s.ULS.sendTraceTag(594887695,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"setSessionInitOverrideCallback failed due to null parameters")},this.forceReconnectSession=function(t){return e._runtimeInitPromise.then((function(){return t.excelServerParameters&&(e.excelServerParameters=t.excelServerParameters),n.runtime.forceReconnectSession()}))},this.submit=function(t){if(null!=t){var o=t.inputSchema,r=t.input,i=t.correlationVector;e._runtimeInitPromise?o&&r?e._runtimeInitPromise.then((function(){n.runtime.submit(o,r,i)})):s.ULS.sendTraceTag(595646425,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"Null parameter. inputSchema:"+o+" correlationVector:"+i+" input:"+r):s.ULS.sendTraceTag(595646424,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"onSubmit called before initialize")}else s.ULS.sendTraceTag(595646423,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"submit failed due to null parameters")},this.addEventHandler=function(t){if(null!=t){var o=t.schemaName,n=t.handler;if(o){var r=e._eventHandlerDictionary[o]||[];r.push(n),e._eventHandlerDictionary[o]=r}}else s.ULS.sendTraceTag(595646426,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"addEventHandler failed due to null parameters")},this.removeEventHandler=function(t){if(null!=t){var o=t.schemaName,n=t.handler;if(o&&n){var r=e._eventHandlerDictionary[o];if(Array.isArray(r)){var i=r.indexOf(n);i>=0&&r.splice(i,1)}}}else s.ULS.sendTraceTag(595646427,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"removeEventHandler failed due to null parameters")},this.registerSimpleRemoteWorkflow=function(t){if(null==t)return s.ULS.sendTraceTag(595646428,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"registerSimpleRemoteWorkflow failed due to null parameters"),Promise.resolve();var o=t.name,r=t.lambdaBefore,i=t.lambdaRemote,a=t.lambdaAfter;if(e._runtimeInitPromise){if(o&&i)return e._runtimeInitPromise.then((function(){return n.runtime.registerSimpleRemoteWorkflow(o,r,i,a)}));s.ULS.sendTraceTag(595646430,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"Null parameters. name:"+o+" lambdaRemote:"+i)}else s.ULS.sendTraceTag(595646429,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"registerSimpleRemoteWorkflow called before initialize");return Promise.resolve()},this.registerSimpleLocalWorkflow=function(t){if(null==t)return s.ULS.sendTraceTag(595646431,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"registerSimpleLocalWorkflow failed due to null parameters"),Promise.resolve();var o=t.name,r=t.lambda;if(e._runtimeInitPromise){if(o&&r)return e._runtimeInitPromise.then((function(){return n.runtime.registerSimpleLocalWorkflow(o,r)}));s.ULS.sendTraceTag(595646433,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"Null parameters. name:"+o+" lambda:"+r)}else s.ULS.sendTraceTag(595646432,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"registerSimpleLocalWorkflow called before initialize");return Promise.resolve()},this.registerReduceWorkflow=function(t){if(null==t)return s.ULS.sendTraceTag(595646434,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"registerReduceWorkflow failed due to null parameters"),Promise.resolve();var o=t.name,r=t.lambda,i=t.groupingKeyExtractor;if(e._runtimeInitPromise){if(o&&r&&i)return e._runtimeInitPromise.then((function(){return n.runtime.registerReduceWorkflow(o,r,i)}));s.ULS.sendTraceTag(595646464,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"Null parameters. name:"+o+" lambda:"+r+" groupingKeyExtractor:"+i)}else s.ULS.sendTraceTag(595646435,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"registerReduceWorkflow called before initialize");return Promise.resolve()},this.registerSchemas=function(t){if(null==t)return s.ULS.sendTraceTag(595646465,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"registerSchemas failed due to null parameters"),Promise.resolve();var o=t.proto,r=t.schemaNames;if(e._runtimeInitPromise){if(o&&r)return e._runtimeInitPromise.then((function(){var e=r.filter((function(e){return!!e}));return n.runtime.registerSchemas(o,e)}));s.ULS.sendTraceTag(595646467,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"Null parameters. proto:"+o+" schemaNames:"+r)}else s.ULS.sendTraceTag(595646466,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,"registerSchemas called before initialize");return Promise.resolve()},this.onResult=function(t,o,n,r){var s=e._eventHandlerDictionary[n];if(s)for(var i=0,a=s;i<a.length;i++){var c=a[i];if(null!=c)c({inputSchema:t,input:o,outputSchema:n,output:r})}},this.onAnnotationResult=function(t){e._annotationResultCallback&&e._annotationResultCallback(t)},this.requestAuthToken=function(t){return e._requestAuthTokenCallback?(e._requestAuthTokenCallback(t)||Promise.resolve("")).then((function(e){var t=e||"";return Promise.resolve({Token:t})})):Promise.resolve({Token:""})},this.sendTelemetryEvent=function(t,o,n,r,s,i){e._sendOTelEventCallback&&e._sendOTelEventCallback(function(e,t,o,n){var r={telemetryProperties:{ariaTenantToken:"3de4087d4de34817b1c376e3d1e6e293-983c4292-5ba9-485a-ab10-9797863c788b-6770",nexusTenantToken:-1},eventName:e.split("_").join("."),dataFields:c(t)};return o&&(r.eventContract={name:o,dataFields:c(n,o.split(".").slice(-1)[0])}),r}(o,n,r,s))},this.isFeatureEnabled=function(t,o){if(!t)return Promise.resolve(!1);var n="Microsoft.Office.AugLoop.";if(0===t.indexOf(n)&&e._featureEnabledCallback){var r=t.slice(n.length);return Promise.resolve(e._featureEnabledCallback(r))}return Promise.resolve(!1)},this.setSessionData=function(t,o,n){e._setSessionDataCallback&&e._setSessionDataCallback(t,o,n)},this.onInitSession=function(){return e._initSessionCallback?e._initSessionCallback():Promise.resolve()}}return e.prototype.submitCustomMessage=function(e){if(null==e){var t="submitCustomMessage failed due to null parameters";return s.ULS.sendTraceTag(595646422,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,t),Promise.reject(new Error(t))}var o=e.message;if(o){if(this._runtimeInitPromise)return this._runtimeInitPromise.then((function(){return n.runtime.submitCustomMessage(o)}));t="submitCustomMessage called before initialize";return s.ULS.sendTraceTag(595628621,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,t),Promise.reject(new Error(t))}var t="Message was null";return s.ULS.sendTraceTag(595628620,s.LogCategory.msoulscat_Wac_BrowserGeneral,s.TraceLevel.Error,t),Promise.reject(new Error(t))},e.prototype.overrideSessionInitMessage=function(e){return this._sessionInitOverrideCallback?this._sessionInitOverrideCallback(e):0===e.clientMetadata.appName.indexOf("Excel")&&this.excelServerParameters?this.overrideExcelSessionInitMessage(e):0===e.clientMetadata.appName.indexOf("PowerPoint")&&this.powerpointParameters?this.overridePowerPointSessionInitMessage(e):e},e.prototype.overrideExcelSessionInitMessage=function(e){for(var t={cluster:this.excelServerParameters.wacCluster,restUrl:this.excelServerParameters.ecsRestUrl,ecsId:this.excelServerParameters.ecsSessionId,ecsOperationUrl:this.excelServerParameters.ecsOperationUrl,workbookMetadataVersion:this.excelServerParameters.metadataVersion,serverEventVersion:this.excelServerParameters.serverEventVersion,permissionFlags:this.excelServerParameters.permissionFlags,configurations:this.excelServerParameters.configurations,collabUserListVersion:this.excelServerParameters.userListVersion,collabStateId:this.excelServerParameters.collabStateId,accessToken:this.excelServerParameters.accessToken,accessTokenTTL:this.excelServerParameters.accessTokenTTL,supportCustomMessages:this.excelServerParameters.supportCustomMessages},o=0,n=Object.keys(e);o<n.length;o++){var r=n[o];t[r]=e[r]}return new i.ExcelServerSessionInitMessage(t)},e.prototype.overridePowerPointSessionInitMessage=function(e){for(var t={downloadUrl:this.powerpointParameters.downloadUrl,getItemsEndPoint:this.powerpointParameters.getItemsEndPoint},o=0,n=Object.keys(e);o<n.length;o++){var r=n[o];t[r]=e[r]}return new a.PowerPointSessionInitMessage(t)},e}();o.AugLoopRuntimeManager=p},{"@augloop/excel-session-protocol/dist/src/generated/messages.g":1,"@augloop/powerpoint-session-protocol/dist/src/generated/messages.g":26,"@augloop/runtime-client":32,"@augloop/schemas/dist/src/client/schemas":57,"@ms/office-online-telemetry/lib/index":"@ms/office-online-telemetry"}],25:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=e("./AugLoopFactory");Object.defineProperty(o,"ALFactoryGlobal",{enumerable:!0,get:function(){return n.ALFactoryGlobal}})},{"./AugLoopFactory":23}],26:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.PowerPointSessionExtensionConfig=o.PowerPointSessionInitMessage=void 0;var n=e("@augloop/types-core"),r=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Powerpoint_Session_Protocol_PowerPointSessionInitMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_SessionInitMessage","AugLoop_Session_Protocol_Message"]},e}();o.PowerPointSessionInitMessage=r;var s=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Powerpoint_Session_Protocol_PowerPointSessionExtensionConfig"},e.getBaseTypes=function(){return[]},e}();o.PowerPointSessionExtensionConfig=s},{"@augloop/types-core":77}],27:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.AnnotationActivationTracker=void 0;var n=e("@augloop/session-protocol"),r=function(){function e(t,o,n){var r=this;this.sessionManager=t,this.annotationType=o,this.options=n,this.token=o+"-"+e.nextActivationResultBatchId++,this.promise=new Promise((function(e,t){r.resolve=e,r.reject=t,r.timeout=setTimeout((function(){r.complete(new Error("Activation timed out"))}),3e4)}))}return e.prototype.asPromise=function(){return this.promise},e.prototype.activate=function(e){var t=this;this.sessionManager().sendMessage(new n.AnnotationActivationMessage({annotationType:this.annotationType,token:this.token,config:this.options?this.options.config:void 0,ignoreExistingAnnotations:e}),(function(e,o){t.complete(e?new Error(e.error):void 0)}))},e.prototype.release=function(){var e=this;return new Promise((function(t,o){e.sessionManager().sendMessage(new n.AnnotationReleaseMessage({token:e.token}),(function(e,n){e?o(new Error(e.error)):t(n.lastRelease)}))}))},e.prototype.complete=function(e){this.isComplete||(this.isComplete=!0,clearTimeout(this.timeout),e?this.reject(e):this.resolve({token:this.token}))},e.nextActivationResultBatchId=1,e}();o.AnnotationActivationTracker=r},{"@augloop/session-protocol":65}],28:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.BatchManager=void 0;var n=e("@augloop/logging/dist/src/client/logging"),r=e("@augloop/schemas/dist/src/client/schemas"),s=function(){function e(e,t){this.batchesByGroupingKey=new Map,this.submit=e,this.onSummary=t}return e.prototype.addBatchItem=function(e,t,o,r,s){var i=this,a=t.delayMs,c=t.maxInputSize,u=t.estimateSize,l=t.groupingKeyExtractor,p=u(e),g=l(e);if(t.split&&p>c){var f;try{f=t.split(e)}catch(e){var h=new Error("Split error: "+e.message);return void(s?s(h):n.Log.error(595150344,n.LogCategory.CoreDefault,h))}if(f&&Array.isArray(f.inputs)&&f.inputs.length>1){for(var d,m=[],y=s?function(e,t){if(d=d||e,m.push(t),m.length===f.inputs.length){var o;try{o=f.join(m)}catch(e){return void s(new Error("Join error: "+e.message))}s(d,o)}}:void 0,v=0,b=f.inputs;v<b.length;v++){var S=b[v];this.addBatchItem(S,t,o,r,y)}return}}var T=this.batchesByGroupingKey.get(g);T&&T.size+p>c&&(clearTimeout(T.timeout),this.executeBatch(g,T,t),T=void 0),T||(T={items:[],size:0,hasItemsWithCallbacks:!1,context:o},this.batchesByGroupingKey.set(g,T)),T.items.push({input:e,size:p,callback:s}),T.size+=p,T.hasItemsWithCallbacks=T.hasItemsWithCallbacks||!!s,T.cv=r,clearTimeout(T.timeout),T.timeout=setTimeout((function(){i.executeBatch(g,T,t)}),a)},e.prototype.executeBatch=function(e,t,o){var s=this;this.batchesByGroupingKey.delete(e);var i,a=t.items,c=function(e){return e<0?"Negative":0===e?"0":1===e?"1":"Magnitude "+e.toString().length},u=new n.Operation({operationName:"ExecuteBatch",cv:t.cv,resourceId:t.context.name,dimension0:"Count "+c(a.length),dimension1:"Size "+c(t.size)}).start(),l=function(e,o,s){var i;if(o&&o.exceptionType===r.ExceptionType.NoOutput)u.success=!0,n.Log.info(594379348,n.LogCategory.CoreDefault,u.stop());else{var c=e+" error: "+(o?o.message||o:"Unknown error");i=o||new Error(c),u.success=!1,u.resultDescription="Batch of "+a.length+" items of size "+t.size+" with "+c,u.resultSignature=e+" Error",n.Log.error(594542914,n.LogCategory.CoreDefault,u.stop())}if(t.hasItemsWithCallbacks)for(var l=0,p=a;l<p.length;l++){var g=p[l];g.callback&&g.callback(i,s)}};try{i=o.multiplex(a.map((function(e){return e.input})))}catch(e){return void l("Multiplex",e)}this.submit(i.input,t,(function(e,r){var c;if(e||"exceptionType"in r||r instanceof Error)l("Submit",e||r,r);else if(t.hasItemsWithCallbacks||o.summaryExtractor){var p=void 0;if(t.hasItemsWithCallbacks)try{if((p=i.demultiplex(r)).length!==a.length)throw new Error("Mismatched output length")}catch(e){return void l("Demultiplex",e)}var g=void 0,f=void 0;if(o.summaryExtractor)try{f=(c=o.summaryExtractor(r))[0],g=c[1]}catch(e){return void l("SummaryExtractor",e)}if(u.success=!0,n.Log.info(594542915,n.LogCategory.CoreDefault,u.stop()),t.hasItemsWithCallbacks)for(var h=0;h<a.length;h++)a[h].callback&&a[h].callback(void 0,p[h]);g&&s.onSummary(f,g,t.context)}else u.success=!0,n.Log.info(594379349,n.LogCategory.CoreDefault,u.stop())}))},e}();o.BatchManager=s},{"@augloop/logging/dist/src/client/logging":16,"@augloop/schemas/dist/src/client/schemas":57}],29:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.isLargerThan=o.estimateSize=void 0,o.estimateSize=function(e){return n(e,Number.POSITIVE_INFINITY)},o.isLargerThan=function(e,t){return n(e,t)>t};var n=function(e,t){for(var o=0,n=[],r=[e];r.length>0;){var s=r.pop(),i=typeof s;if("boolean"===i)o+=4;else if("string"===i)o+=2*s.length;else if("number"===i)o+=8;else if("object"===i&&s&&-1===n.indexOf(s))if(s instanceof Uint8Array)o+=s.length;else for(var a in n.push(s),s)r.push(s[a]);if(o>t)return o}return o}},{}],30:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.internalFetch=void 0;var n=e("./sequential-fetch-queue"),r=e("cross-fetch");o.internalFetch=function(e,t,o){var n=new r.Request(e,t);return s.add(n,o)};var s=new n.SequentialFetchQueue(r,2e4,12e4)},{"./sequential-fetch-queue":38,"cross-fetch":89}],31:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.LambdaSource=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.Local=1]="Local",e[e.Custom=2]="Custom",e[e.Remote=3]="Remote",e[e.BatchedRemote=4]="BatchedRemote"}(o.LambdaSource||(o.LambdaSource={}))},{}],32:[function(e,t,o){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||t.hasOwnProperty(o)||n(t,e,o)};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./runtime-client");Object.defineProperty(o,"runtime",{enumerable:!0,get:function(){return s.runtime}}),Object.defineProperty(o,"createRuntime",{enumerable:!0,get:function(){return s.createRuntime}}),r(e("./iclientruntime"),o)},{"./iclientruntime":31,"./runtime-client":37}],33:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.ReduceTimerCache=void 0;var n=function(){function e(){this.cache=new Map}return e.prototype.setReduceTimer=function(e,t,o,n){var r=this;void 0===n&&(n=500),this.cache.has(e)||this.cache.set(e,new Map);var s=this.cache.get(e);s.has(t)&&clearTimeout(s.get(t)),s.set(t,setTimeout((function(){s.size>1?s.delete(t):r.cache.delete(e),o()}),n))},e}();o.ReduceTimerCache=n},{}],34:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.executeRemoteLambda=void 0;var n=e("@augloop/logging/dist/src/client/logging"),r=e("@augloop/schemas/dist/src/client/schemas"),s=e("./fetch"),i=new(e("./token-cache").TokenCache),a=function(e,t,o,c,u,l,p,g,f,h){var d={method:"POST",headers:{"content-type":"application/json","X-CorrelationId":u},body:JSON.stringify({payload:t.payload,payloadSchema:o,requestedSchema:c,clientMetadata:l,tokens:i.getAuthTokenEntries(p,f.docId)})};s.internalFetch(e,d,(function(s,d){s?h(new Error("Fetch error in remote lambda request to "+e+": "+s)):401===d.status?g>0?(n.Log.info(595915806,n.LogCategory.CoreDefault,"Auth token required for remote lambda request"),d.json().then((function(e){return i.updateAuthToken(p,{Tickets:[e],DocId:f.docId})})).then((function(){a(e,t,o,c,u,l,p,g-1,f,h)})).catch((function(e){h({exceptionType:r.ExceptionType.Authentication,message:e.message})}))):h({exceptionType:r.ExceptionType.Authentication,message:"Remote lambda request retry with authentication token failed"}):d.ok?d.json().then((function(e){if(Array.isArray(e))if(e.length>0)for(var o=0,n=0,r=e;n<r.length;n++){var s=r[n];t.moreResults=++o<e.length,h(null,s)}else h(new Error("No output"));else h(new Error("Did not receive a valid response for remote lambda request"))})).catch((function(e){h({exceptionType:r.ExceptionType.LambdaThrow,message:e.message})})):h(new Error("Remote lambda request failed with status "+d.status))}))};o.executeRemoteLambda=function(e,t,o,n,s,c,u,l,p){Array.isArray(l.authTickets)?i.updateAuthToken(u,{Tickets:l.authTickets,DocId:l.docId}).then((function(){a(e,t,o,n,s.id,c,u,1,l,p)})).catch((function(e){p({exceptionType:r.ExceptionType.Authentication,message:e.message})})):a(e,t,o,n,s.id,c,u,1,l,p)}},{"./fetch":30,"./token-cache":42,"@augloop/logging/dist/src/client/logging":16,"@augloop/schemas/dist/src/client/schemas":57}],35:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.testWebSocketConnection=o.executeRemoteLambda=void 0;var n=e("@augloop/logging/dist/src/client/logging"),r=e("@augloop/schemas/dist/src/client/schemas"),s=e("./websocket/websocket-request-manager"),i=e("./token-cache"),a=e("./websocket/websocket-worker"),c=new i.TokenCache,u=new s.WebSocketRequestManager(3e4,(function(){return new a.WebSocketWorker}),50),l=function(e,t,o,s,i,a,p,g,f,h){var d={payload:t.payload,payloadSchema:o,requestedSchema:s,clientMetadata:a,tokens:c.getAuthTokenEntries(p,f.docId)},m="";s&&s.schema&&(m=s.schema.name);var y=!1;u.addRequest(e,d,i,m,(function(u,d,m){if(!y)if(y=!0,null!=d)if(d.exceptionType===r.ExceptionType.Authentication)try{var v=JSON.parse(d.data);g>0?(n.Log.info(593892171,n.LogCategory.CoreDefault,"Auth token required for remote lambda WebSocket request"),c.updateAuthToken(p,{Tickets:[v],DocId:f.docId}).then((function(){l(e,t,o,s,i,a,p,g-1,f,h)})).catch((function(e){h({exceptionType:r.ExceptionType.Authentication,message:e.message})}))):h({exceptionType:r.ExceptionType.Authentication,message:"Remote lambda request retry with authentication token failed"})}catch(e){h({exceptionType:r.ExceptionType.Authentication,message:e.message})}else h(new Error("Error in remote lambda WebSocket request to "+e+": "+d));else t.moreResults=!1,h(null,u)}))};o.executeRemoteLambda=function(e,t,o,n,s,i,a,u,p){Array.isArray(u.authTickets)?c.updateAuthToken(a,{Tickets:u.authTickets,DocId:u.docId}).then((function(){l(e,t,o,n,s.id,i,a,1,u,p)})).catch((function(e){p({exceptionType:r.ExceptionType.Authentication,message:e.message})})):l(e,t,o,n,s.id,i,a,1,u,p)},o.testWebSocketConnection=function(e,t){return u.testConnection(e,t)}},{"./token-cache":42,"./websocket/websocket-request-manager":50,"./websocket/websocket-worker":53,"@augloop/logging/dist/src/client/logging":16,"@augloop/schemas/dist/src/client/schemas":57}],36:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.ResultCache=void 0;var n=function(){function e(){this.cache=new Map,this.bucketSizes=new Map}return e.prototype.setBucketSize=function(e,t){this.bucketSizes.set(e,t)},e.prototype.setResult=function(e,t,o){if(t.primary){var n=this.cache.get(e);n||(n=new Map,this.cache.set(e,n));var r=n.get(t.primary);if(r||(r=t.secondary?new Map:[],n.set(t.primary,r)),t.secondary){r.set(t.secondary,o)}else{var s=r;s.length==this.getBucketSize(e)&&s.shift(),s.push(o)}}},e.prototype.getResults=function(e,t){var o=this.cache.get(e);if(o){var n=o.get(t.primary);if(n){if(!t.secondary)return n;var r=Array.from(n.values());if(r.length>0)return r}}return[]},e.prototype.deleteAllResults=function(e){this.cache.forEach((function(t){if(e.secondary){var o=t.get(e.primary);o&&o.delete(e.secondary)}else t.delete(e.primary)}))},e.prototype.getBucketSize=function(e){return this.bucketSizes.get(e)||10},e}();o.ResultCache=n},{}],37:[function(e,t,o){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(o,"__esModule",{value:!0}),o.createRuntime=o.runtime=o.ClientRuntime=o.getTypeFromSchema=o.Workflow=void 0;var r,s=e("@augloop/interfaces"),i=e("@augloop/logging/dist/src/client/logging"),a=e("@augloop/schemas/dist/src/client/schemas"),c=e("./iclientruntime"),u=e("./remote-lambda-http"),l=e("./remote-lambda-ws"),p=e("./reduce-timer-cache"),g=e("./result-cache"),f=e("./telemetry-logger"),h=e("./websocket/websocket-worker"),d=e("./websocket/websocket-session-manager"),m=e("./throttling"),y=e("./batch-manager"),v=e("./estimate-size"),b=e("./session"),S=e("./utils"),T=e("./websocket/isession-manager"),_=e("./websocket/session-initializer"),C=e("./websocket/token-refresh-manager");!function(e){e[e.Restricted=0]="Restricted",e[e.Unrestricted=1]="Unrestricted",e[e.Suppressed=2]="Suppressed"}(r||(r={}));var w=function(){function e(){this.stateByDocId=new Map,this.executionQueueByDocId=new Map}return e.prototype.scheduleExecution=function(e,t){var o=this.docIdExtractor?this.docIdExtractor(e):void 0,n=this.getStateForDocId(o);if(n===r.Restricted){var s=this.getExecutionQueueForDocId(o);s.push(t),1===s.length&&t()}else n===r.Unrestricted?t():r.Suppressed},e.prototype.onFinish=function(e,t){if(t===a.ExceptionType.Authentication)this.stateByDocId.set(e,r.Suppressed),this.executionQueueByDocId.delete(e);else if(this.stateByDocId.get(e)===r.Restricted){var o=this.getExecutionQueueForDocId(e);if(o.shift(),void 0===t){this.stateByDocId.set(e,r.Unrestricted),this.executionQueueByDocId.delete(e);for(var n=0,s=o;n<s.length;n++){(0,s[n])()}}else if(o.length>0){(0,o[0])()}}},e.prototype.getStateForDocId=function(t){var o=this.stateByDocId.get(t);return void 0===o&&(o=e.executionQueuesEnabled?r.Restricted:r.Unrestricted,this.stateByDocId.set(t,o)),o},e.prototype.getExecutionQueueForDocId=function(e){var t=this.executionQueueByDocId.get(e);return void 0===t&&(t=[],this.executionQueueByDocId.set(e,t)),t},e.executionQueuesEnabled=!0,e}();o.Workflow=w,o.getTypeFromSchema=function(e){return{category:a.TypeCategory.Schema,schema:{name:e}}};var M=function(){function t(e,t,o){this.inputSchemasToWorkflows=new Map,this.inputSchemasToReduceWorkflows=new Map,this.reduceWorkflowsGroupingKeyExtractors=new Map,this.defaultWorkflowOptions={canProduceNullResult:!1,shouldSendResultsToHost:!0,enabledByDefault:!1,throttleSettings:{shouldBeThrottled:!1}},this.resultCache=new g.ResultCache,this.reduceTimerCache=new p.ReduceTimerCache,this.lookupTableCache=new Map,this.sessionsByDocSessionId=new Map,this.execution=new m.ExecutionWithThrottling,this.isThrottlingEnabled=!1,this.workerFactory=e||function(){return new h.WebSocketWorker},this.sessionManagerFactory=t||this.createDefaultSessionManagerFactory(),this.sessionFactory=o||function(e){return new b.Session(e)}}return t.prototype.init=function(t,o,n,r){var s=this,a=new i.Operation({operationName:"InitRuntime",resourceId:t});a.start(),this.clientMetadata=o,this.clientMetadata&&(this.clientMetadata.runtimeVersion=e("../../package.json").version),this.hostCallbacks=n,i.Log.addLogger(new f.TelemetryLogger(this.hostCallbacks));var c=r.telemetryAggregationIntervalSec,p=r.initSession,g=r.batchOptions;if(c>0){var h=function(e,t,o){return new i.LoggingAggregator(e,(function(e){return e.success&&o.indexOf(e[t])>=0}),[t,"resourceId","success","resultSignature","dimension0","dimension1","dimension2","dimension3"],["durationMs"],c)};i.Log.addAggregator(h("Operation","operationName",["ExecuteLambda","ExecuteWorkflow","ExecuteBatch","ProcessResponse"])),i.Log.addAggregator(h("SessionHealth","sessionHealthEventName",["ProcessMessage","SendMessage"]))}this.batchOptions=g;var d=[];return d.push(this.isFeatureEnabled("UseWebSocket").then((function(e){return!!e&&l.testWebSocketConnection(S.Utils.convertServiceUrlToWebSocket(t),s.clientMetadata)})).then((function(e){t&&(s.serviceUrl=e?S.Utils.convertServiceUrlToWebSocket(t):t,s.executeRemoteLambda=e?l.executeRemoteLambda:u.executeRemoteLambda,s.serviceProtocol=s.serviceUrl.split(":")[0].toLowerCase())}))),d.push(this.isFeatureEnabled("ThrottlingEnabled").then((function(e){s.isThrottlingEnabled=e}))),d.push(this.isFeatureEnabled("WorkflowQueuesDisabled").then((function(e){w.executionQueuesEnabled=!e}))),Promise.all(d).then((function(){s.serviceUrl&&p&&s.createSession(),s.logOperation(a,!0)})).catch((function(e){s.logOperation(a,!1,"Error",e?e.message:"(no error)")}))},t.prototype.getServiceProtocol=function(){return this.serviceProtocol},t.prototype.registerSchemas=function(e,t){return Promise.resolve()},t.prototype.registerSimpleLocalWorkflow=function(e,t,o){return void 0===o&&(o=this.defaultWorkflowOptions),t.source=t.source||c.LambdaSource.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToWorkflows,o)},t.prototype.registerSimpleRemoteWorkflow=function(e,t,o,n,r){void 0===r&&(r=this.defaultWorkflowOptions);var s=[];return t&&(t.source=c.LambdaSource.Custom,s.push(t)),o.source=o.func?c.LambdaSource.Custom:c.LambdaSource.Remote,s.push(o),n&&(n.source=c.LambdaSource.Custom,s.push(n)),this.registerHardcodedWorkflow(e,s,this.inputSchemasToWorkflows,r)},t.prototype.registerMultipleLambdasWorkflow=function(e,t,o){return void 0===o&&(o=this.defaultWorkflowOptions),this.registerHardcodedWorkflow(e,t,this.inputSchemasToWorkflows,o)},t.prototype.registerReduceWorkflow=function(e,t,o,n,r){return void 0===n&&(n=10),void 0===r&&(r=this.defaultWorkflowOptions),this.reduceWorkflowsGroupingKeyExtractors.set(t.inputSchema,o),this.resultCache.setBucketSize(t.inputSchema,n),t.source=t.source||c.LambdaSource.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToReduceWorkflows,r)},t.prototype.registerMultipleLambdasReduceWorkflow=function(e,t,o,n,r){return void 0===n&&(n=10),void 0===r&&(r=this.defaultWorkflowOptions),this.reduceWorkflowsGroupingKeyExtractors.set(t[0].inputSchema,o),this.resultCache.setBucketSize(t[0].inputSchema,n),this.registerHardcodedWorkflow(e,t,this.inputSchemasToReduceWorkflows,r)},t.prototype.activateAnnotation=function(e,t){return this.getSession().activateAnnotation(e,t)},t.prototype.updateAnnotationConfig=function(e,t){this.getSession().updateAnnotationConfig(e,t)},t.prototype.releaseAnnotation=function(e){return this.getSession().releaseAnnotation(e)},t.prototype.setAnnotationState=function(e,t,o){this.getSession().setAnnotationState(e,t,o)},t.prototype.submit=function(e,t,o){this.submitToWorkflows(e,t,o,this.inputSchemasToWorkflows)},t.prototype.submitOperation=function(e,t){this.getSession().submitOperation(e,t)},t.prototype.submitOperations=function(e,t){this.getSession().submitOperations(e,t)},t.prototype.submitCustomMessage=function(e){return this.getSession().submitCustomMessage(e)},t.prototype.submitSeedOperations=function(e,t){this.getSession().submitSeedOperations(e,t)},t.prototype.flushTelemetry=function(e){i.Log.flushAggregators(e)},t.prototype.requestCacheDump=function(e){return this.getSession().requestCacheDump(e)},t.prototype.forceReconnectSession=function(){return this.getSession().forceReconnect()},t.prototype.closeSession=function(){this.getSession().close()},t.prototype.createSession=function(e){var t=e?e.docSessionId:void 0;if(this.sessionsByDocSessionId.has(t))throw new Error("docSessionId already exists");var o=n({},this.clientMetadata);o.docSessionId=t,e&&e.flights&&(o.flights=o.flights?o.flights+";"+e.flights:e.flights);var r=this.sessionFactory({hostCallbacks:this.hostCallbacks,sessionManager:this.sessionManagerFactory(o),batchOptions:this.batchOptions,extensionConfigs:(null==e?void 0:e.extensionConfigs)||[]});return this.sessionsByDocSessionId.set(t,r),r.initialize?r.initialize():Promise.resolve(r)},t.prototype.getSession=function(e){return this.sessionsByDocSessionId.get(e)},t.prototype.createDefaultSessionManagerFactory=function(){var e=this;return function(t){var o=new C.TokenRefreshManager,n=new T.SessionStats,r=function(){i.Log.error(594113806,i.LogCategory.CoreDefault,"Unexpectedly not set sendMessage")},s=new _.SessionInitializer((function(){return n}),t,o,(function(e,t){r(e,t)}),{getAuthToken:e.getAuthToken.bind(e),setSessionDataCallback:e.hostCallbacks.setSessionData,overrideSessionInitMessage:e.hostCallbacks.overrideSessionInitMessage}),a=new d.WebSocketSessionManager(S.Utils.convertServiceUrlToWebSocket(e.serviceUrl),n,e.workerFactory,s);return r=a.sendMessage.bind(a),a.on("connectionClose",(function(){return o.clearTimeouts()})),a}},t.prototype.getAuthToken=function(){return this.hostCallbacks.requestAuthToken({Tickets:[]}).then((function(e){if(e)return e.Token})).catch((function(){}))},t.prototype.getGroupingKey=function(e,t,o){var n=this.reduceWorkflowsGroupingKeyExtractors.get(o);if(null==n)throw new Error("Reduce workflow does not have a grouping extractor");return n(t,e)},t.prototype.submitToWorkflows=function(e,t,n,r){var s=this;if(void 0===r&&(r=this.inputSchemasToWorkflows),this.hostCallbacks){var c;c=n?i.CorrelationVector.fromString(n):new i.CorrelationVector;for(var u=r.get(e)||[],l=function(n){var u={messageType:a.MessageType.Input,correlationVector:c.newChild(),payload:t,payloadSchema:o.getTypeFromSchema(n.lambdas[0].inputSchema),clientMetadata:p.clientMetadata},l=new i.Operation({cv:u.correlationVector.toString(),operationName:"ExecuteWorkflow",resourceId:n.name});l.start(),n.scheduleExecution(t,(function(){try{if(s.isThrottlingEnabled)if(u.payload&&u.payload.tile&&u.payload.tile.metadata&&u.payload.tile.metadata.tileId){var o=u.payload.tile.metadata.tileId;s.execution.execute(o,n,(function(){return s.executeWorkflow(l,u,t,n,e,r)}))}else s.executeWorkflow(l,u,t,n,e,r);else s.executeWorkflow(l,u,t,n,e,r)}catch(e){l.success=!1,l.resultSignature="ExecuteException",l.resultDescription=e?e.message:"(no error)",i.Log.error(594364430,i.LogCategory.CoreDefault,l.stop())}}))},p=this,g=0,f=u;g<f.length;g++){l(f[g])}}},t.prototype.executeWorkflow=function(e,t,o,n,r,c){var u=this,l=n.docIdExtractor?n.docIdExtractor(t.payload):void 0,p=function(t){var p=t.messageType==a.MessageType.Exception&&t.payload.exceptionType==a.ExceptionType.NoOutput,g=p&&n.canProduceNullResult,f=g?n.lambdas[n.lambdas.length-1].outputSchema:t.payloadSchema.schema.name,h=g?null:t.payload;t.messageType===a.MessageType.Input||g?(n.shouldSendResultsToHost&&(c===u.inputSchemasToReduceWorkflows?u.hostCallbacks.onResult("Reduce.Input",o,f,h):u.hostCallbacks.onResult(r,o,f,h)),e.success=!0,e.resultSignature=p?"NoOutput":"ValidOutput"):p?(e.success=!0,e.resultSignature="NoOutput"):(e.success=!1,e.resultSignature="Exception",e.resultDescription=s.getMessageExceptionDescription(t)),c!==u.inputSchemasToReduceWorkflows&&u.updateResultCacheForReduceWorkflows(r,o,f,h,t.correlationVector.toString()),t.moreResults||(e.stop(),i.Log.info(594364432,i.LogCategory.CoreDefault,e),n.onFinish(l,t.payload&&t.payload.exceptionType?s.getMessageExceptionType(t):void 0))};n.preExecutionPromise.then((function(){for(var e={lookupTable:u.lookupTableCache.get(n.name),docId:l},o=p,r=n.lambdas.length-1;r>=0;r--)o=u.createLambdaExecutionStep(n.name,n.lambdas[r],e,o,p);o(t)}))},t.prototype.updateResultCacheForReduceWorkflows=function(e,t,o,n,r){var s=this;if(this.inputSchemasToReduceWorkflows.get(o)){var c,u="~"+o;"docId"===e?(c={primary:t},this.resultCache.setResult(u,c,n),c.secondary="*"):(c=this.getGroupingKey(e,t,o),!function(e,t){return"Tiling.TextTileEvent"===e&&t&&t.type==a.Tiling.TextTileEventType.Delete||"ClpSlideTile"===e&&t&&t.eventType==a.Ppt.SlideTileEventType.Delete}(e,t)||null==c.primary||null==c.secondary?this.resultCache.setResult(o,c,n):this.resultCache.deleteAllResults(c)),this.reduceTimerCache.setReduceTimer(o,c.primary,(function(){var e=s.resultCache.getResults(o,c);if(e.push.apply(e,s.resultCache.getResults(u,{primary:c.primary})),Array.isArray(e)){var t={id:c.primary,values:e};s.submitToWorkflows(o,t,r,s.inputSchemasToReduceWorkflows)}else i.Log.error(594364431,i.LogCategory.CoreDefault,'Cached results have unexpected type "'+typeof e+'"')}))}},t.prototype.isFeatureEnabled=function(e,t,o){return void 0===t&&(t=!1),void 0===o&&(o="None"),this.hostCallbacks&&this.hostCallbacks.isFeatureEnabled?this.hostCallbacks.isFeatureEnabled("Microsoft.Office.AugLoop."+e,o).catch((function(){return Promise.resolve(t)})):Promise.resolve(t)},t.prototype.areLicenseFeaturesEnabled=function(e){return this.hostCallbacks&&this.hostCallbacks.areLicenseFeaturesEnabled?this.hostCallbacks.areLicenseFeaturesEnabled(e).catch((function(){return Promise.resolve(!1)})):Promise.resolve(!1)},t.prototype.isWorkflowEnabled=function(e,t,o,n,r){var s=this;if(t.some((function(e){return e.source===c.LambdaSource.Remote}))){if(!this.serviceUrl)return r.resultDescription="Disabled because no service URL available for remote workflow",Promise.resolve(!1);if(this.clientMetadata&&this.clientMetadata.privateMode&&t.some((function(e){return e.source===c.LambdaSource.Remote&&!e.canRunInPrivateMode})))return r.resultDescription="Disabled because we are running in private mode",Promise.resolve(!1)}return(!this.clientMetadata||"Mac"!==this.clientMetadata.appPlatform&&"Win32"!==this.clientMetadata.appPlatform)&&(n=!0,r.resultDescription="Enabled by default due to platform name"),(n?Promise.resolve(!0):this.isFeatureEnabled("WorkflowEnabled."+e)).then((function(t){return t?s.isFeatureEnabled("WorkflowDisabled."+e).then((function(e){return e?(r.resultDescription="Disabled because explicitly disabled",!1):!o||s.areLicenseFeaturesEnabled(o).then((function(e){return e||(r.resultDescription="Disabled because license check failed"),e}))})):(r.resultDescription="Disabled because not explicitly enabled",!1)}))},t.prototype.registerHardcodedWorkflow=function(e,t,n,r){var s=this;if(void 0===n&&(n=this.inputSchemasToWorkflows),!e||e.length>40)throw new Error("Workflow name has invalid length");if(!1===new RegExp(/^[A-Z][a-zA-Z0-9_]+$/).test(e))throw new Error("Workflow name has invalid format");n.forEach((function(t){if(t.some((function(t){return t.name===e})))throw new Error("Workflow name already registered.")}));var c=new i.Operation({operationName:"WorkflowRegistration",resourceId:e,success:!0});return c.setClientMetadata(this.clientMetadata),c.start(),this.isWorkflowEnabled(e,t,r.licenseFeatures,r.enabledByDefault,c).then((function(u){if(c.resultSignature=u?"Enabled":"Disabled",c.stop(),i.Log.info(594364433,i.LogCategory.CoreDefault,c),u){var l=t[0].inputSchema,p=n.get(l);p||(p=[],n.set(l,p));var g=Promise.resolve();r.lookupTableLambda&&(g=new Promise((function(t,n){var c=new i.CorrelationVector,u={messageType:a.MessageType.Input,correlationVector:c,payloadSchema:o.getTypeFromSchema(r.lookupTableLambda.inputSchema),clientMetadata:s.clientMetadata,payload:{}},l=function(o){o.messageType===a.MessageType.Input&&o.payload&&s.lookupTableCache.set(e,o.payload),t()};s.createLambdaExecutionStep("",r.lookupTableLambda,{},l,l)(u)})));var f=new w;f.name=e,f.lambdas=t,f.canProduceNullResult=r.canProduceNullResult,f.shouldSendResultsToHost=r.shouldSendResultsToHost,f.throttleSettings=r.throttleSettings||s.defaultWorkflowOptions.throttleSettings,f.docIdExtractor=r.docIdExtractor,f.preExecutionPromise=g,p.push(f)}}))},t.prototype.logOperation=function(e,t,o,n){e.stop(),e.success=t,e.resultSignature=o,e.resultDescription=n,i.Log.info(594364434,i.LogCategory.CoreDefault,e)},t.prototype.handleLambdaError=function(e,t,o,n,r){null!=e.exceptionType?s.setMessageException(t,e):e instanceof Error?s.setMessageException(t,{exceptionType:n,message:e.message}):s.setMessageException(t,{exceptionType:a.ExceptionType.Unknown,message:e?e.toString():void 0}),this.logOperation(o,!1,"Exception",s.getMessageExceptionDescription(t)),r(t)},t.prototype.handleLambdaOutput=function(e,t,n,r,i,c){e&&e.exceptionType!==a.ExceptionType.NoOutput?null!=e.exceptionType?this.handleLambdaError(e,t,n,e.exceptionType,c):e instanceof Error?this.handleLambdaError(e,t,n,a.ExceptionType.LambdaErrorCallback,c):(t.payload=e,t.payloadSchema=o.getTypeFromSchema(r),this.logOperation(n,!0),i(t)):(s.setMessageException(t,{exceptionType:a.ExceptionType.NoOutput}),this.logOperation(n,!0,"NoOutput"),c(t))},t.prototype.executeCustomLambdaStep=function(e,t,o,n,r,i){var c=this;if(null==o.func)s.setMessageException(e,{exceptionType:a.ExceptionType.LambdaThrow,message:"No lambda function set"}),this.logOperation(t,!1,"Error",s.getMessageExceptionDescription(e)),i(e);else{try{o.func(e.payload,o.config,n,(function(n){c.handleLambdaOutput(n,e,t,o.outputSchema,r,i)}),(function(o,n){c.handleLambdaOutput(o,e,t,n,i,i)}))}catch(o){this.handleLambdaError(o,e,t,a.ExceptionType.LambdaThrow,i)}}},t.prototype.executeLocalLambdaStep=function(e,t,o,n,r){var i=this;null==this.hostCallbacks.executeLocalLambda?(s.setMessageException(e,{exceptionType:a.ExceptionType.LambdaThrow,message:"No local lambda host callback set"}),this.logOperation(t,!1,"Error",s.getMessageExceptionDescription(e)),r(e)):this.hostCallbacks.executeLocalLambda(o.inputSchema,e.payload,o.outputSchema).then((function(s){i.handleLambdaOutput(s,e,t,o.outputSchema,n,r)})).catch((function(o){i.handleLambdaError(o,e,t,a.ExceptionType.LambdaThrow,r)}))},t.prototype.executeRemoteLambdaStep=function(e,t,n,r,i,u){var l=this;if(this.serviceUrl){t.resourceId+="."+this.serviceProtocol;var p=function(o,r){o?l.handleLambdaError(o,e,t,o.exceptionType||a.ExceptionType.LambdaErrorCallback,u):l.handleLambdaOutput(r,e,t,n.outputSchema,i,u)};if(r.authTickets=n.authTickets,n.source===c.LambdaSource.Remote)this.executeRemoteLambda(this.serviceUrl,e,o.getTypeFromSchema(n.inputSchema),o.getTypeFromSchema(n.outputSchema),e.correlationVector,this.clientMetadata,this.hostCallbacks,r,p);else{this.batchedRemoteLambdaManager||(this.batchedRemoteLambdaManager=new y.BatchManager((function(e,t,n){var r=t.context,s=r.remoteLambda,i=r.lambdaContext;l.executeRemoteLambda(l.serviceUrl,{messageType:a.MessageType.Input,correlationVector:{id:t.cv},payload:e,payloadSchema:o.getTypeFromSchema(s.inputSchema),clientMetadata:l.clientMetadata},o.getTypeFromSchema(s.remoteInputSchema),o.getTypeFromSchema(s.remoteOutputSchema),{id:t.cv},l.clientMetadata,l.hostCallbacks,i,n)}),(function(e,t,o){var n=o.lambdaContext;l.updateResultCacheForReduceWorkflows("docId",n.docId,e,t)})));var g=n.batchOptions,f=this.normalizeBatchOptions(g),h=f.groupingKeyExtractor;f.groupingKeyExtractor=function(e){return n.name+"-"+h(e)};var d={name:n.name,remoteLambda:n,lambdaContext:r};this.batchedRemoteLambdaManager.addBatchItem(e.payload,f,d,e.correlationVector.id.length>127?e.correlationVector.id.substring(0,127)+"!":e.correlationVector.id,p)}}else s.setMessageException(e,{exceptionType:a.ExceptionType.LambdaThrow,message:"No URL for remote lambda"}),this.logOperation(t,!1,"Error",s.getMessageExceptionDescription(e)),u(e)},t.prototype.createLambdaExecutionStep=function(e,t,o,n,r){var u=this;return function(l){var p=new i.Operation({cv:l.correlationVector.toString(),operationName:"ExecuteLambda",resourceId:t.name,dimension0:e});p.start(),t.source===c.LambdaSource.Custom?u.executeCustomLambdaStep(l,p,t,o,n,r):t.source===c.LambdaSource.Local?u.executeLocalLambdaStep(l,p,t,n,r):t.source===c.LambdaSource.Remote||t.source===c.LambdaSource.BatchedRemote?u.executeRemoteLambdaStep(l,p,t,o,n,r):(s.setMessageException(l,{exceptionType:a.ExceptionType.LambdaThrow,message:"Unknown/No lambda location set"}),u.logOperation(p,!1,"Error",s.getMessageExceptionDescription(l)),r(l))}},t.prototype.normalizeBatchOptions=function(e){if(!e)throw new Error("Expected batchConfig");var t=n({},e);return e.estimateSize||(t.estimateSize=v.estimateSize),t},t}();o.ClientRuntime=M,o.runtime=new M,o.createRuntime=function(){return new M}},{"../../package.json":54,"./batch-manager":28,"./estimate-size":29,"./iclientruntime":31,"./reduce-timer-cache":33,"./remote-lambda-http":34,"./remote-lambda-ws":35,"./result-cache":36,"./session":39,"./telemetry-logger":40,"./throttling":41,"./utils":43,"./websocket/isession-manager":45,"./websocket/session-initializer":47,"./websocket/token-refresh-manager":49,"./websocket/websocket-session-manager":51,"./websocket/websocket-worker":53,"@augloop/interfaces":9,"@augloop/logging/dist/src/client/logging":16,"@augloop/schemas/dist/src/client/schemas":57}],38:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.SequentialFetchQueue=void 0;var n=function(){function e(e,t,o){if(this.requestInProgress=!1,this.queuedRequests=[],null==e)throw new Error("No request.");this.fetch=e,this.fetchTimeout=t,this.queueTimeout=o}return e.prototype.tryProcessNextRequest=function(){if(this.requestInProgress=!1,this.queuedRequests.length>0){var e=this.queuedRequests.shift(),t=e[0],o=e[1],n=e[2];clearTimeout(n),this.add(t,o)}},e.prototype.add=function(e,t){var o=this;if(this.requestInProgress){var n=setTimeout((function(){t(new Error("Timed out waiting in queue"),null),o.queuedRequests.shift()}),this.queueTimeout);this.queuedRequests.push([e,t,n])}else{this.requestInProgress=!0,new Promise((function(t,n){var r=!1,s=setTimeout((function(){r=!0,n(new Error("Fetch timed out"))}),o.fetchTimeout);o.fetch(e).then((function(e){r||(clearTimeout(s),t(e))})).catch((function(e){r||(clearTimeout(s),n(e))}))})).then((function(e){t(null,e),o.tryProcessNextRequest()})).catch((function(e){t(e,null),o.tryProcessNextRequest()}))}},e}();o.SequentialFetchQueue=n},{}],39:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.Session=void 0;var n=e("@augloop/session-protocol"),r=e("@augloop/types-core"),s=e("./annotation-activation-tracker"),i=e("./batch-manager"),a=e("./estimate-size"),c=e("./websocket/empty-session-manager"),u=function(){function e(e){this.annotationActivationTrackers=new Map,this.annotationCallbacks=new Map,this.nextSyncSequenceId=1,this.isSeedSubmitted=!1,this.hostCallbacks=e.hostCallbacks,this.sessionManager=e.sessionManager,this.operationBatchConfig=e.batchOptions?this.getOperationBatchConfig(e.batchOptions):void 0,this.extensionConfigs=e.extensionConfigs,this.sessionManager.on("sessionClose",this.onSessionClose.bind(this)),this.sessionManager.on("reconnect",this.onReconnect.bind(this)),this.sessionManager.on("resetNextSyncSequenceId",this.resetNextSyncSequenceId.bind(this)),this.sessionManager.onMessage(n.AnnotationResultsMessage.getTypeName(),this.onAnnotationResults.bind(this))}return e.prototype.initialize=function(){var e=this;return this.sessionManager.init(this.extensionConfigs,this.hostCallbacks.onInitSession?this.hostCallbacks.onInitSession:void 0).then((function(){return e}))},e.prototype.activateAnnotation=function(e,t){var o=new s.AnnotationActivationTracker(this.getSessionManager.bind(this),e,t);if(t&&t.callback){var n=this.annotationCallbacks.get(e);n||(n=new Map,this.annotationCallbacks.set(e,n)),n.set(o.token,t.callback)}return this.annotationActivationTrackers.set(o.token,o),o.activate(!1),o.asPromise()},e.prototype.updateAnnotationConfig=function(e,t){throw new Error("Not Yet Implemented")},e.prototype.releaseAnnotation=function(e){var t=this.annotationActivationTrackers.get(e);if(t){this.annotationActivationTrackers.delete(e);var o=this.annotationCallbacks.get(t.annotationType);return o&&(o.delete(e),0==o.size&&this.annotationCallbacks.delete(t.annotationType)),t.release()}return Promise.resolve(!1)},e.prototype.setAnnotationState=function(e,t,o){var n={state:o};this.submitOperation(new r.UpdateAnnotationMetaDataOperation({parentPath:e,items:[{id:t}],M_:n}))},e.prototype.submitOperation=function(e,t){this.submitOperations([e],t)},e.prototype.submitOperations=function(e,t){var o=this;if(this.operationBatchConfig){if(!this.batchedOperationsManager){this.batchedOperationsManager=new i.BatchManager((function(e,t,r){o.getSessionManager().sendMessage(new n.SyncMessage({cv:t.cv,seq:o.nextSyncSequenceId++,ops:e}),(function(e){r(e?new Error(e.error):void 0)}))}))}this.batchedOperationsManager.addBatchItem(e,this.operationBatchConfig,{name:"SubmitOperations"},t)}else this.getSessionManager().sendMessage(new n.SyncMessage({cv:t,seq:this.nextSyncSequenceId++,ops:e}))},e.prototype.submitSeedOperations=function(e,t){var o=this;if(this.isSeedSubmitted)throw new Error("Cannot submit seed operations more than once per session");if(this.isSeedSubmitted=!0,this.operationBatchConfig){var r=e.length,s=0,a=0;new i.BatchManager((function(e,t,i){s++;var c=(a+=e.length)===r;o.getSessionManager().sendMessage(new n.SyncMessage({cv:t.cv,seq:0,ops:e,groupId:"Seed",groupSize:c?s:void 0,groupComplete:c||void 0}),(function(e){i(e?new Error(e.error):void 0)}))})).addBatchItem(e,this.operationBatchConfig,{name:"SubmitSeedOperations"},t)}else this.getSessionManager().sendMessage(new n.SyncMessage({cv:t,seq:0,ops:e}))},e.prototype.submitCustomMessage=function(e){var t=this;return new Promise((function(o,n){t.getSessionManager().sendMessage(e,(function(e,t){e?n(e):o(t)}))}))},e.prototype.requestCacheDump=function(e){var t=this;if(e)throw new Error("NYI");return new Promise((function(e,o){t.getSessionManager().sendMessage(new n.CacheDumpRequestMessage,(function(t,n){t?o(t):e(n)}))}))},e.prototype.forceReconnect=function(e){return this.extensionConfigs=e,this.getSessionManager().forceReconnect(e)},e.prototype.close=function(){this.getSessionManager().closeSession()},e.prototype.setSessionCloseCallback=function(e){this.sessionCloseCallback=e},e.prototype.resetNextSyncSequenceId=function(){this.nextSyncSequenceId=1},e.prototype.onReconnect=function(){this.annotationActivationTrackers.forEach((function(e){e.activate(!0)}))},e.prototype.onSessionClose=function(e){this.sessionCloseCallback&&this.sessionCloseCallback(e)},e.prototype.getSessionManager=function(){return this.sessionManager||(this.sessionManager=new c.EmptySessionManager),this.sessionManager},e.prototype.onAnnotationResults=function(e,t){t(void 0,new n.Response);for(var o=0,r=e.ops;o<r.length;o++){var s=r[o];this.callAnnotationCallbacks(s,e.annotationType),this.hostCallbacks.onAnnotationResult&&this.hostCallbacks.onAnnotationResult(s)}},e.prototype.callAnnotationCallbacks=function(e,t){if(0!==this.annotationCallbacks.size){var o=this.annotationCallbacks.get(t);o&&o.forEach((function(t){t(e)}))}},e.prototype.getOperationBatchConfig=function(e){return{delayMs:e.delayMs,maxInputSize:e.maxInputSize,estimateSize:a.estimateSize,groupingKeyExtractor:function(){return"operations"},multiplex:function(e){return{input:e.filter((function(e){return e.length})).reduce((function(e,t){return e.concat(t)}),[]),demultiplex:function(){return[[]]}}},split:function(e){if(!(e.length<=1))return{inputs:e.reduce((function(e,t){return e.push([t]),e}),[]),join:function(){return[]}}}}},e}();o.Session=u},{"./annotation-activation-tracker":27,"./batch-manager":28,"./estimate-size":29,"./websocket/empty-session-manager":44,"@augloop/session-protocol":65,"@augloop/types-core":77}],40:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.TelemetryLogger=void 0;var n=e("@augloop/interfaces"),r=function(){function e(e){this.level=n.LoggingLevel.info,this.hostCallbacks=e}return e.prototype.log=function(e){var t=this;if(null!=this.hostCallbacks&&null!=this.hostCallbacks.sendTelemetryEvent){var o=function(e,o){var n=o.charAt(0).toUpperCase()+o.slice(1);t.hostCallbacks.sendTelemetryEvent(null,"Office_AugLoop_Client_"+n,{ResourceId:e.resourceId,ResultDescription:e.resultDescription,ResultSignature:e.resultSignature,Dimension0:e.dimension0,Dimension1:e.dimension1,Dimension2:e.dimension2,Dimension3:e.dimension3},"Office.System.Activity",{CV:e.cv,Duration:1e3*e.durationMs,Count:e.count,AggMode:2,Success:e.success},!1)};if("Operation"===e.eventName){o(e,e.operationName)}else if("SessionHealth"===e.eventName){o(e,e.sessionHealthEventName)}}},e}();o.TelemetryLogger=r},{"@augloop/interfaces":9}],41:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.ExecutionWithThrottling=void 0;var n=e("./utils"),r=function(){function e(){this.throttleInfoMap=new Map}return e.prototype.execute=function(e,t,o){var r=this;if(t.throttleSettings.shouldBeThrottled&&t.throttleSettings.throttlingInterval>0){var s=this.getWorkflowThrottleInfo(t.name);if(null==s.currentTileId)s.currentTileId=e,s.timeOfPreviousStartedEvent=n.Utils.getCurrentTimeMs(),o();else if(s.currentTileId===e){var i=n.Utils.getCurrentTimeMs(),a=this.delayTime(s,i,t.throttleSettings.throttlingInterval);a>0?(s.latestCallback=o,null==s.lastTimeout&&(s.lastTimeout=setTimeout((function(){var e=r.getWorkflowThrottleInfo(t.name);e.lastTimeout=void 0,e.timeOfPreviousStartedEvent=n.Utils.getCurrentTimeMs(),e.latestCallback()}),a))):(s.timeOfPreviousStartedEvent=i,o())}else null!=s.lastTimeout&&(clearTimeout(s.lastTimeout),s.latestCallback(),s.lastTimeout=void 0),s.currentTileId=e,s.timeOfPreviousStartedEvent=n.Utils.getCurrentTimeMs(),o()}else o()},e.prototype.delayTime=function(e,t,o){var n=t-e.timeOfPreviousStartedEvent;return Math.max(o-n,0)},e.prototype.getWorkflowThrottleInfo=function(e){var t=this.throttleInfoMap.get(e);return t||(t={currentTileId:void 0,timeOfPreviousStartedEvent:-1,latestCallback:function(){},lastTimeout:void 0},this.throttleInfoMap.set(e,t)),t},e}();o.ExecutionWithThrottling=r},{"./utils":43}],42:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.TokenCache=void 0;var n=e("./utils"),r=function(){function e(e){void 0===e&&(e=33e5),this.tokenCache=new Map,this.requestMap=new Map,this.requestRecordMap=new Map,this.tokenExpirationMs=e}return e.prototype.updateAuthToken=function(e,t){var o=this,r=JSON.stringify(t),s=this.requestRecordMap.get(r);return(void 0===s||this.isTokenExpired(s))&&(s={requestPromise:e.requestAuthToken(t).then((function(e){if(!e||!e.Token)throw new Error("No token available for request "+r);o.tokenCache.set(r,e.Token)})),requestTime:n.Utils.getCurrentTimeMs()},this.requestRecordMap.set(r,s)),s.requestPromise},e.prototype.getAuthTokenEntries=function(e,t){var o=this;return Array.from(this.tokenCache.keys()).map((function(e){var t=o.requestMap.get(e);return void 0===t&&(t=JSON.parse(e),o.requestMap.set(e,t)),{requestKey:e,request:t}})).filter((function(e){var o=e.request;return!t||o.DocId===t})).map((function(t){var n=t.requestKey,r=t.request;return o.isTokenExpired(o.requestRecordMap.get(n))&&o.updateAuthToken(e,r),{ticket:r.Tickets[0],token:o.tokenCache.get(n)}}))},e.prototype.isTokenExpired=function(e){return n.Utils.getCurrentTimeMs()>e.requestTime+this.tokenExpirationMs},e}();o.TokenCache=r},{"./utils":43}],43:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.LogCountLimiter=o.Utils=void 0;var n=e("@augloop/logging/dist/src/client/logging"),r=function(){function e(){}return e.convertServiceUrlToWebSocket=function(e){var t=e.split(":"),o=t[0].toLowerCase();return 0==o.indexOf("http")?(o=o.replace("http","ws"),t[0]=o,t.join(":")):e},e.getCurrentTimeMs=function(){return Date.now?Date.now():(new Date).getTime()},e}();o.Utils=r;var s=function(){function e(e){this.maxNumberOfLogs=40,this.numberOfLogs=0,this.id=e}return e.prototype.log=function(e){if(this.numberOfLogs<this.maxNumberOfLogs&&(this.numberOfLogs++,e(),this.numberOfLogs===this.maxNumberOfLogs)){var t=new n.Operation({operationName:"OnLastLog",success:!0,resourceId:this.id,resultDescription:"Limit for number of logs for id: "+this.id+" reached - all next logs will be dropped"});n.Log.warn(594834508,n.LogCategory.CoreDefault,t)}},e}();o.LogCountLimiter=s},{"@augloop/logging/dist/src/client/logging":16}],44:[function(e,t,o){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.EmptySessionManager=void 0;var s=e("@augloop/logging/dist/src/client/logging"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.init=function(){return Promise.resolve()},t.prototype.sendMessage=function(e,t){},t.prototype.onMessage=function(e,t){},t.prototype.forceReconnect=function(){return Promise.resolve()},t.prototype.closeSession=function(){},t.prototype.sendBytes=function(e){},t.prototype.getCorrelationVector=function(){return new s.CorrelationVector},t.prototype.setState=function(e){},t}(e("eventemitter3").EventEmitter);o.EmptySessionManager=i},{"@augloop/logging/dist/src/client/logging":16,eventemitter3:91}],45:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.SessionStats=void 0;var n=function(){};o.SessionStats=n},{}],46:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.MessageQueue=o.ClientSendMessageErrorReason=void 0;var n,r=e("@augloop/session-protocol"),s=e("@augloop/types-core"),i=e("double-ended-queue"),a=e("../utils"),c=e("@augloop/logging/dist/src/client/logging");!function(e){e.ArrivedBeforeReseeding="Message is dropped from queue since it arrived before reseeding is started",e.DroppedAsOldestInQueue="Message is dropped as oldest in full queue"}(n=o.ClientSendMessageErrorReason||(o.ClientSendMessageErrorReason={}));var u=function(){function e(e){this.logOp=new c.Operation({operationName:"MessageQueue",success:!0}),this.messageQueueLogCountLimiter=new a.LogCountLimiter("MessageQueue"),this.queue=new i(1e3),this.callbacks=e}return e.prototype.push=function(e,t,o){var s=this,i=this.queue;if(1e3===i.length){this.messageQueueLogCountLimiter.log((function(){s.logOp.resourceId="QueueFull",s.logOp.durationMs=0,c.Log.warn(594362819,c.LogCategory.CoreDefault,s.logOp)}));var u=i.shift();u.onResponse&&u.onResponse(new r.ErrorResponse({error:n.DroppedAsOldestInQueue}))}i.push({message:e,onResponse:t,timeQueued:a.Utils.getCurrentTimeMs(),attemptNumber:o})},e.prototype.sendOnSessionInitialized=function(e){var t=this,o=this.queue.length,i=0;if(o>0){for(var u=a.Utils.getCurrentTimeMs()-this.queue.get(0).timeQueued;this.queue.length>0&&this.callbacks.canSendMessage();){var l=this.queue.shift();e&&l.message instanceof r.SyncMessage&&s.SchemaObject.matchesTypesFor(l.message,[r.SyncMessage.getTypeName()])?(i++,l.onResponse&&l.onResponse(new r.ErrorResponse({error:n.ArrivedBeforeReseeding}))):l.message instanceof Uint8Array?this.callbacks.sendBytes(l.message):this.callbacks.sendMessage(l.message,l.onResponse,l.attemptNumber)}this.messageQueueLogCountLimiter.log((function(){t.logOp.resourceId="SendOnSessionInitialized",t.logOp.resultDescription="Queue size before: "+o+", after: "+t.queue.length+". droppedSyncMessages: "+i,t.logOp.durationMs=u,c.Log.warn(594362821,c.LogCategory.CoreDefault,t.logOp)}))}},e}();o.MessageQueue=u},{"../utils":43,"@augloop/logging/dist/src/client/logging":16,"@augloop/session-protocol":65,"@augloop/types-core":77,"double-ended-queue":90}],47:[function(e,t,o){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.SessionInitializer=void 0;var s=e("@augloop/logging/dist/src/client/logging"),i=e("@augloop/session-protocol"),a=e("../utils"),c=e("./token-refresh-manager"),u=function(e){function t(t,o,n,r,s){var i=e.call(this)||this;return i.getSessionStats=t,i.clientMetadata=o,i.tokenRefreshManager=n,i.sendMessage=r,i.options=s||{},i.options.overrideSessionInitMessage=i.options.overrideSessionInitMessage||function(e){return e},i.options.setSessionDataCallback=i.options.setSessionDataCallback||function(){},i}return r(t,e),t.prototype.initSession=function(e){var t=this;e.onResponse=e.onResponse||function(){};var o=a.Utils.getCurrentTimeMs(),n=this.getSessionStats().lastConnectionClose&&o-this.getSessionStats().lastConnectionClose,r=this.getSessionStats().lastSyncMessage&&o-this.getSessionStats().lastSyncMessage,c=new s.Operation({operationName:"SessionInit",resultDescription:JSON.stringify({sessionKey:this.sessionKey,sessionId:this.clientMetadata.sessionId,timeSinceLastConnectionClose:n,timeSinceLastSyncMessage:r,isTokenRefresh:e.isTokenRefresh})}),u=this.options.overrideSessionInitMessage(new i.SessionInitMessage({protocolVersion:i.currentProtocolVersion,clientMetadata:this.clientMetadata,sessionKey:this.sessionKey,origin:this.origin,authToken:this.anonymousToken,extensionConfigs:e.extensionConfigs}));this.sendMessage(u,(function(o,n){if(c.success=!o,c.resultSignature=t.getSessionStats().lastConnectionClose?"Reconnect":"FirstConnect",s.Log.info(594875485,s.LogCategory.CoreDefault,c),e.onResponse(o,n),!(o||e.isReconnectOnSameSlice&&n.forceReconnect)){if(!n.anonymousToken||!n.tokenExpirationSeconds)return void s.Log.error(594875486,s.LogCategory.CoreDefault,"AL Anonymous token was not generated for the session");t.anonymousToken=n.anonymousToken,t.onSuccessfulSessionInitOnServerSide(n)}}))},t.prototype.onSuccessfulSessionInitOnServerSide=function(e){this.tokenRefreshManager.scheduleRefresh(c.TokenType.Anonymous,e.tokenExpirationSeconds,this.initSession.bind(this,{isTokenRefresh:!0})),this.initHostAuthToken();var t=!!this.sessionKey||this.sessionKey&&this.sessionKey!==e.sessionKey;this.sessionKey!==e.sessionKey&&this.options.setSessionDataCallback(e.sessionUrlBase+"/"+e.sessionKey,e.origin,this.anonymousToken),this.sessionKey&&this.sessionKey!==e.sessionKey?this.emit("init",!0):this.emit("init",!1),this.sessionKey=e.sessionKey,this.origin=e.origin,t&&this.emit("reconnect")},t.prototype.initHostAuthToken=function(){var e=this;this.options.getAuthToken&&this.options.getAuthToken().then((function(t){t?e.sendTokenProvisionMessage(t):s.Log.info(594834502,s.LogCategory.CoreDefault,"Host auth token provision failed")})).catch((function(e){s.Log.error(594834503,s.LogCategory.CoreDefault,"Error happened while attempting to fetch host token: "+e)}))},t.prototype.sendTokenProvisionMessage=function(e){var t=new i.TokenProvisionMessage({authToken:e});this.sendMessage(t,this.onTokenProvisionResponse.bind(this))},t.prototype.onTokenProvisionResponse=function(e,t){!e&&t&&t.tokenExpirationSeconds&&this.tokenRefreshManager.scheduleRefresh(c.TokenType.Host,t.tokenExpirationSeconds,this.initHostAuthToken.bind(this))},t}(e("eventemitter3").EventEmitter);o.SessionInitializer=u},{"../utils":43,"./token-refresh-manager":49,"@augloop/logging/dist/src/client/logging":16,"@augloop/session-protocol":65,eventemitter3:91}],48:[function(e,t,o){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.ClosedState=o.DisconnectedState=o.RunningState=o.InitingState=o.BaseState=o.queueBytes=o.queueMessage=o.sendMessageNow=o.SessionState=void 0;var s,i=e("@augloop/session-protocol"),a=e("@augloop/types-core");!function(e){e[e.Initing=0]="Initing",e[e.Running=1]="Running",e[e.Disconnected=2]="Disconnected",e[e.Closed=3]="Closed"}(s=o.SessionState||(o.SessionState={})),o.sendMessageNow=function(e,t,o,n){t&&(t.cv||(t.cv=e.cvParent.newChild().toString()),e.messageEndpoint.sendMessage(t,(function(t,n){t||a.SchemaObject.getTypeNameFor(n)!==i.SyncResponse.getTypeName()||(e.stats.lastSyncMessage=Date.now()),o&&o(t,n)}),void 0,n))},o.queueMessage=function(e,t,o,n){t&&(e.messageQueue.push(t,o,n),e.webSocketWorkerManager.init(void 0,e.customInitPromise))},o.queueBytes=function(e,t){t&&(e.messageQueue.push(t),e.webSocketWorkerManager.init(void 0,e.customInitPromise))};var c=function(){function e(e){this.context=e}return e.prototype.onEnter=function(e){},e.prototype.sendMessage=function(e,t,o){},e.prototype.sendBytes=function(e){},e.prototype.canSendMessage=function(){return!1},e.prototype.onConnectionClose=function(){},e}();o.BaseState=c;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=s.Initing,t.possibleNextStates=[s.Running,s.Disconnected,s.Closed],t}return r(t,e),t.prototype.sendMessage=function(e,t,n){a.SchemaObject.matchesTypesFor(e,[i.SessionInitMessage.getTypeName()])?o.sendMessageNow(this.context,e,t,n):o.queueMessage(this.context,e,t)},t.prototype.sendBytes=function(e){o.queueBytes(this.context,e)},t.prototype.onConnectionClose=function(){this.context.setState(s.Disconnected)},t}(c);o.InitingState=u;var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=s.Running,t.possibleNextStates=[s.Disconnected,s.Closed],t}return r(t,e),t.prototype.onEnter=function(e){e&&e.isSessionReseedingStarted&&this.context.resetNextSyncSequenceId(),this.context.messageQueue.sendOnSessionInitialized(e&&e.isSessionReseedingStarted)},t.prototype.sendMessage=function(e,t,n){o.sendMessageNow(this.context,e,t,n)},t.prototype.sendBytes=function(e){e&&this.context.webSocketWorkerManager.egressBytes(e)},t.prototype.canSendMessage=function(){return!0},t.prototype.onConnectionClose=function(){this.context.setState(s.Disconnected)},t}(c);o.RunningState=l;var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=s.Disconnected,t.possibleNextStates=[s.Initing,s.Closed],t}return r(t,e),t.prototype.onEnter=function(e){this.context.messageEndpoint.cancelPendingResponseCallbacks()},t.prototype.sendMessage=function(e,t,n){a.SchemaObject.matchesTypesFor(e,[i.SessionInitMessage.getTypeName()])?(this.context.setState(s.Initing),o.sendMessageNow(this.context,e,t,n)):o.queueMessage(this.context,e,t,n)},t.prototype.sendBytes=function(e){o.queueBytes(this.context,e)},t}(c);o.DisconnectedState=p;var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=s.Closed,t.possibleNextStates=[],t}return r(t,e),t}(c);o.ClosedState=g},{"@augloop/session-protocol":65,"@augloop/types-core":77}],49:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.TokenRefreshManager=o.TokenType=void 0,function(e){e[e.Anonymous=0]="Anonymous",e[e.Host=1]="Host"}(o.TokenType||(o.TokenType={}));var n=function(){function e(){this.timers=new Map}return e.prototype.scheduleRefresh=function(t,o,n){var r=this.timers.get(t);r||(r={numberOfAttempts:0},this.timers.set(t,r)),r.timeoutId&&(clearTimeout(r.timeoutId),r.timeoutId=void 0);var s=1e3*o-e.tokenExpirationBufferMs;s>0?r.numberOfAttempts=0:(++r.numberOfAttempts,s=e.tokenRefreshBackoffIntervalMs),r.numberOfAttempts<=e.tokenRefreshMaximumAttempts&&(r.timeoutId=setTimeout((function(){return n()}),s))},e.prototype.clearTimeouts=function(){this.timers.forEach((function(e){clearTimeout(e.timeoutId)})),this.timers=new Map},e.tokenExpirationBufferMs=24e4,e.tokenRefreshBackoffIntervalMs=3e4,e.tokenRefreshMaximumAttempts=3,e}();o.TokenRefreshManager=n},{}],50:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.WebSocketRequestManager=void 0;var n=e("@augloop/logging/dist/src/client/logging"),r=e("@augloop/schemas/dist/src/client/schemas"),s=e("../utils"),i=function(){function e(e,t,o,n,r,s){this.requestId=e,this.correlationId=t,this.schemaName=o,this.data=n,this.callback=r,this.requestTimeoutInMs=s,this.ended=!1,this.startTime=0}return e.prototype.startRequest=function(){this.startTime=s.Utils.getCurrentTimeMs()},e.prototype.getMsUntilTimeout=function(){var e=s.Utils.getCurrentTimeMs()-this.startTime;return this.requestTimeoutInMs-e},e.prototype.endRequest=function(e){this.ended||(this.invokeCallback(null,e,!0),this.ended=!0)},e.prototype.addResponseData=function(e){this.invokeCallback(e,null,!1)},e.prototype.invokeCallback=function(e,t,o){var n=this;new Promise((function(){return n.callback(e,t,o)})).catch((function(e){}))},e}(),a=function(){function e(e,t,o){this.requestCounter=0,this.activeRequests=[],this.pendingRequests=[],this.requestTimeoutInMs=e,this.workerFactory=t,this.maxActiveRequests=o}return e.prototype.testConnection=function(e,t){var o=this,s=!1,i=new n.Operation({cv:(new n.CorrelationVector).toString(),operationName:"WebSocketTest",resourceId:e});return i.success=!0,i.start(),new Promise((function(a){var c={payload:{},payloadSchema:{category:r.TypeCategory.Schema,schema:{name:"HealthCheckRequest"}},requestedSchema:{category:r.TypeCategory.Schema,schema:{name:"HealthCheckResponse"}},clientMetadata:t};o.addRequest(e,c,i.cv,"HealthCheckRequest",(function(e,t,o){t&&(i.success=!1,i.resultSignature="Error",i.resultDescription=t.message||t),e&&"OK"===e.status&&(s=!0),o&&(i.success&&!s&&(i.success=!1,i.resultSignature="NoResponseData"),i.stop(),n.Log.info(593892170,n.LogCategory.CoreDefault,i),a(i.success))}))}))},e.prototype.addRequest=function(e,t,o,n,r){var s=(this.requestCounter++).toString(),a=new i(s,o,n,t,r,this.requestTimeoutInMs);this.getWorker(e),this.pendingRequests.push(a),this.egressPendingRequests()},e.prototype.egressPendingRequests=function(){for(;this.pendingRequests.length>0&&this.activeRequests.length<this.maxActiveRequests;){var e=this.pendingRequests.shift();if(this.activeRequests.push(e),1===this.activeRequests.length){var t=e.getMsUntilTimeout();setTimeout(this.onTimeout.bind(this),t)}e.startRequest(),this.worker&&this.worker.egress(this.createRequestMessage(e.data,e.requestId,e.correlationId))}},e.prototype.createRequestMessage=function(e,t,o){return JSON.stringify({correlationId:o,requestId:t,body:e})},e.prototype.onTimeout=function(){for(;this.activeRequests.length>0;){var e=this.activeRequests[0],t=e.getMsUntilTimeout();if(!(t<=0))return void setTimeout(this.onTimeout.bind(this),t);var o=new Error("Request timed out");e.endRequest(o),this.activeRequests.shift(),this.egressPendingRequests()}},e.prototype.onMessage=function(e){for(var t=JSON.parse(e),o=0;o<this.activeRequests.length;o++){var n=this.activeRequests[o];if(n.requestId===t.requestId){t.end?(this.activeRequests.splice(o,1),n.endRequest(t.error),this.egressPendingRequests()):t.body&&n.addResponseData(t.body);break}}},e.prototype.onClose=function(e){for(var t=new Error("Connection closed: "+e),o=0,n=this.activeRequests;o<n.length;o++){n[o].endRequest(t)}this.activeRequests=[];for(var r=0,s=this.pendingRequests;r<s.length;r++){s[r].endRequest(t)}this.pendingRequests=[],this.worker=void 0},e.prototype.getWorker=function(e){return this.worker||(this.worker=this.workerFactory(),this.worker.init(e,this.onMessage.bind(this),this.onClose.bind(this))),this.worker},e}();o.WebSocketRequestManager=a},{"../utils":43,"@augloop/logging/dist/src/client/logging":16,"@augloop/schemas/dist/src/client/schemas":57}],51:[function(e,t,o){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.WebSocketSessionManager=void 0;var s=e("@augloop/logging/dist/src/client/logging"),i=e("@augloop/logging/dist/src/session-health-event"),a=e("@augloop/session-protocol"),c=e("@augloop/types-core"),u=e("./websocket-worker-manager"),l=e("../utils"),p=e("eventemitter3"),g=e("./message-queue"),f=e("./session-states"),h=function(e){function t(t,o,n,r){var i,c=e.call(this)||this;return c.cvParent=new s.CorrelationVector,c.logOp=new s.Operation({operationName:"SessionState",success:!0}).start(),c.sessionStateChangeLogCountLimiter=new l.LogCountLimiter("SessionState"),c.stats=o,c.allStates=((i={})[f.SessionState.Initing]=new f.InitingState(c),i[f.SessionState.Running]=new f.RunningState(c),i[f.SessionState.Disconnected]=new f.DisconnectedState(c),i[f.SessionState.Closed]=new f.ClosedState(c),i),c.setState(f.SessionState.Initing),c.messageEndpoint=new a.MessageEndpoint("c"),c.messageEndpoint.setEgress(c.egress.bind(c)),c.messageEndpoint.onMessage(a.SessionCloseMessage.getTypeName(),c.onSessionClose.bind(c)),c.webSocketWorkerManager=new u.WebSocketWorkerManager(t,n,r,c.ingress.bind(c),c.onConnectionClose.bind(c)),c.messageQueue=new g.MessageQueue({sendMessage:function(e,t,o){return c.state.sendMessage(e,t,o)},sendBytes:c.sendBytes.bind(c),canSendMessage:function(){return c.state.canSendMessage()}}),r.on("init",c.onSessionInitialized.bind(c)),r.on("reconnect",(function(){return c.emit("reconnect")})),c.resetNextSyncSequenceId=function(){return c.emit("resetNextSyncSequenceId")},c}return r(t,e),t.prototype.setState=function(e,t,o){var n=this;if(!this.state||e!==this.state.stateName){var r="undefined";this.state&&(r=f.SessionState[this.state.stateName]);var i="undefined"===r&&e===f.SessionState.Initing||this.state.possibleNextStates.indexOf(e)>=0;this.sessionStateChangeLogCountLimiter.log((function(){n.logOp.stop(),n.logOp.resourceId="New state: "+(i?f.SessionState[e]:r),n.logOp.resultDescription="Previous state: "+r,n.logOp.resultSignature=t+(n.state&&!i?"Unexpected state change":""),n.logOp.success=i,s.Log.info(594551965,s.LogCategory.CoreDefault,n.logOp)})),i&&(this.state=this.allStates[e],this.logOp.start(),this.state.onEnter(o))}},t.prototype.init=function(e,t){return this.extensionConfigs=e,this.customInitPromise=t,this.webSocketWorkerManager.init(this.extensionConfigs,this.customInitPromise,!0)},t.prototype.sendMessage=function(e,o){this.retrySendMessage(e,o,t.maxRetries)},t.prototype.sendBytes=function(e){this.state.sendBytes(e)},t.prototype.onMessage=function(e,t){this.messageEndpoint.onMessage(e,t)},t.prototype.getCorrelationVector=function(){return this.cvParent},t.prototype.forceReconnect=function(e){return this.extensionConfigs=e||this.extensionConfigs,this.webSocketWorkerManager.close(!1),this.webSocketWorkerManager.init(this.extensionConfigs),Promise.resolve()},t.prototype.closeSession=function(){this.webSocketWorkerManager.close(!0),this.onSessionClose(void 0,(function(){}))},t.prototype.onSessionInitialized=function(e){this.setState(f.SessionState.Running,"",{isSessionReseedingStarted:e})},t.prototype.ingress=function(e){var t,o=this;try{t=JSON.parse(e)}catch(e){s.Log.error(595886723,s.LogCategory.CoreDefault,new i.SessionHealth({sessionHealthEventName:"ProcessMessage",resourceId:"Unknown",success:!1,resultSignature:"ParseError",resultDescription:e.message,durationMs:0,source:i.SessionHealthSource.ClientRuntime,reason:i.SessionHealthReason.Client,impact:i.SessionHealthImpact.MissingOutput,affectedWorkflows:["All"],message:""}))}t&&this.messageEndpoint.ingress(t,(function(e,t){return o.egress(e||t,(function(){}))}))},t.prototype.egress=function(e,t){e&&this.webSocketWorkerManager.egress(e).then((function(){return t()})).catch((function(e){return t(e)}))},t.prototype.onSessionClose=function(e,t){this.setState(f.SessionState.Closed),this.onConnectionClose(void 0),e&&this.emit("sessionClose",e),t()},t.prototype.onConnectionClose=function(e){this.state.onConnectionClose(),this.stats.lastConnectionClose=l.Utils.getCurrentTimeMs(),this.emit("connectionClose")},t.prototype.retrySendMessage=function(e,o,n){var r=this,s=t.maxRetries-n;this.state.sendMessage(e,(function(t,s){t&&n>0&&r.canBeRetried(e)&&r.isTransientError(t)?r.retrySendMessage(e,o,n-1):o&&o(t,s)}),s)},t.prototype.canBeRetried=function(e){return!c.SchemaObject.matchesTypesFor(e,[a.SessionInitMessage.getTypeName()])},t.prototype.isTransientError=function(e){var t=e.error;return t!==a.SendMessageErrorReason.SyncMessageUnsupportedBatch&&t!==a.SendMessageErrorReason.UnexpectedSeedMessage&&t!==a.SendMessageErrorReason.UnsupportedSyncMessage&&t!==g.ClientSendMessageErrorReason.ArrivedBeforeReseeding&&t!==g.ClientSendMessageErrorReason.DroppedAsOldestInQueue},t.maxRetries=2,t}(p.EventEmitter);o.WebSocketSessionManager=h},{"../utils":43,"./message-queue":46,"./session-states":48,"./websocket-worker-manager":52,"@augloop/logging/dist/src/client/logging":16,"@augloop/logging/dist/src/session-health-event":22,"@augloop/session-protocol":65,"@augloop/types-core":77,eventemitter3:91}],52:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.WebSocketWorkerManager=o.calculateTimeToWaitForNextTry=void 0;var n=e("@augloop/types-core"),r=e("@augloop/session-protocol"),s=e("@augloop/logging/dist/src/client/logging"),i=e("../utils"),a=e("@augloop/jsond");o.calculateTimeToWaitForNextTry=function(e,t){var o=0,n=i.Utils.getCurrentTimeMs()?i.Utils.getCurrentTimeMs()-t:0,r=[1e3,2e3,5e3,1e4,6e4];return o=r[Math.max(0,Math.min(r.length-1,e-1))],o=Math.max(o-n,1e3)};var c=function(){function e(t,o,n,r,s){this.logCountLimiter=new i.LogCountLimiter(e.className),this.isWorkerReady=!1,this.permanentlyClosed=!1,this.currentReconnectAttempt=0,this.lastInitializationAttemptTimeMs=0,this.alreadyLoggedReconnectAttempt=!1,this.globalUrl=t,this.workerFactory=o,this.sessionInitializer=n,this.ingress=r,this.onClose=s}return e.prototype.init=function(t,o,n){var r=this;if(void 0===n&&(n=!1),this.isWorkerReady||this.pendingInitPromise)return this.pendingInitPromise?this.pendingInitPromise:Promise.resolve();if(this.extensionConfigs=t||this.extensionConfigs,n||!this.alreadyLoggedReconnectAttempt){var i=n?e.initialAttemptTimeout:e.reconnectAttemptTimeout;this.connTimeout=setTimeout((function(){var e=new s.Operation({operationName:"ConnectionFailingOrSlow",dimension0:n?"Initial":"Reconnect",dimension1:i.toString(),dimension2:r.currentReconnectAttempt.toString()});s.Log.info(590448259,s.LogCategory.CoreDefault,e),r.alreadyLoggedReconnectAttempt=!n,r.connTimeout=void 0}),i)}return o?this.pendingInitPromise=o().catch((function(e){s.Log.error(593835868,s.LogCategory.CoreDefault,"Error occurred during calling the custom init promise: "+e)})).then((function(){r.initInternal()})):(this.pendingInitPromise=Promise.resolve(),this.initInternal()),this.pendingInitPromise},e.prototype.egress=function(e){var t=this;return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then((function(){t.egressInternal(e)})):(this.egressInternal(e),Promise.resolve())},e.prototype.egressBytes=function(e){var t=this;return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then((function(){t.egressBytesInternal(e)})):(this.egressBytesInternal(e),Promise.resolve())},e.prototype.close=function(e){this.worker&&this.worker.close(),this.isWorkerReady=!1,this.worker=null,this.permanentlyClosed=e||this.permanentlyClosed},e.prototype.initInternal=function(){var e=this;this.isWorkerReady=!1,this.permanentlyClosed||(this.currentReconnectAttempt>0?setTimeout((function(){e.tryToConnectAndInitializeSession()}),o.calculateTimeToWaitForNextTry(this.currentReconnectAttempt,this.lastInitializationAttemptTimeMs)):this.tryToConnectAndInitializeSession())},e.prototype.egressInternal=function(e){var t;this.isWorkerReady||n.SchemaObject.matchesTypesFor(e,[r.SessionInitMessage.getTypeName()])?(n.SchemaObject.matchesTypesFor(e,[r.MicroSyncMessage.getTypeName()])?(this.castBinaryData(e),t=a.JSOND.serialize(e)):t=JSON.stringify(e),this.worker.egress(t)):n.SchemaObject.matchesTypesFor(e,[r.Response.getTypeName()])||s.Log.error(594551963,s.LogCategory.CoreDefault,new s.Operation({operationName:"UnexpectedEgressCall",resultDescription:"isWorkerReady: "+this.isWorkerReady}))},e.prototype.egressBytesInternal=function(e){this.isWorkerReady?this.worker.egress(e):s.Log.error(594551964,s.LogCategory.CoreDefault,new s.Operation({operationName:"UnexpectedEgressBytesCall",resultDescription:"isWorkerReady: "+this.isWorkerReady}))},e.prototype.tryToConnectAndInitializeSession=function(){var e=this;this.currentReconnectAttempt++,this.lastInitializationAttemptTimeMs=i.Utils.getCurrentTimeMs();var t=function(o){e.permanentlyClosed||(e.connect(e.sliceUrl?e.sliceUrl:e.globalUrl),e.sessionInitializer.initSession({isTokenRefresh:!1,isReconnectOnSameSlice:!!e.sliceUrl,extensionConfigs:e.extensionConfigs,onResponse:function(n,r){if(e.logCountLimiter.log((function(){o.success=!n,o.resultDescription=n?n.error:"",o.resourceId=r?r.sliceUrl:"",o.stop(),s.Log.info(594642311,s.LogCategory.CoreDefault,o)})),n||!e.worker)e.sliceUrl=void 0,e.close(),e.initInternal();else if(r.forceReconnect){e.close();var i=new s.Operation({operationName:"ForcedReconnect"}).start();i.resultSignature="globalUrl: "+e.globalUrl+". sliceUrl: "+e.sliceUrl,e.sliceUrl=void 0,setTimeout((function(){t(i)}),1e3)}else void 0!==e.connTimeout&&clearTimeout(e.connTimeout),e.sliceUrl=r.sliceUrl,e.ready()}}))},o=new s.Operation({operationName:"TryToConnectAndInitializeSession",resultSignature:"Reconnection attempt #"+this.currentReconnectAttempt}).start();t(o)},e.prototype.connect=function(e){var t=this;this.worker=this.workerFactory(),this.worker.init(e,this.ingress,(function(e){t.onClose(e),t.close()}))},e.prototype.ready=function(){this.isWorkerReady=!0,this.pendingInitPromise=void 0,this.currentReconnectAttempt=0},e.prototype.castBinaryData=function(e){if(e){if(Array.isArray(e.__binaryMembers__))for(var t=0,o=e.__binaryMembers__;t<o.length;t++){var n=o[t];ArrayBuffer.isView(e[n])||(e[n]=new Uint8Array(e[n]))}for(var r=0,s=Object.keys(e);r<s.length;r++){var i=s[r];"object"==typeof e[i]&&null!==e[i]&&this.castBinaryData(e[i])}}},e.initialAttemptTimeout=1e5,e.reconnectAttemptTimeout=2e4,e.className="WebSocketWorkerManager",e}();o.WebSocketWorkerManager=c},{"../utils":43,"@augloop/jsond":14,"@augloop/logging/dist/src/client/logging":16,"@augloop/session-protocol":65,"@augloop/types-core":77}],53:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.WebSocketWorker=void 0;var n=e("isomorphic-ws"),r=e("@augloop/logging/dist/src/client/logging"),s=e("../utils"),i=function(){function e(){this.hasBeenOpened=!1,this.hadEgressError=!1,this.lastEgressTime=0,this.lastPongTime=0,this.remainingPingFailures=3,this.pendingEgress=[]}return e.prototype.init=function(t,o,s){var i=this;this.ws=new n(t),this.logOp=new r.Operation({operationName:e.className,success:!0}).start();var a=function(e){i.logPingLatencyOp.stop(),i.logPingLatencyOp.success=e,r.Log.info(592836228,r.LogCategory.CoreDefault,i.logPingLatencyOp),i.logPingLatencyOp=void 0};this.ws.addEventListener("open",(function(t){e.logCountLimiter.log((function(){i.logOp.resourceId="OnOpen",i.logOp.resultDescription="",i.logOp.success=!0,i.logOp.stop(),r.Log.info(594642307,r.LogCategory.CoreDefault,i.logOp)})),i.hasBeenOpened=!0,i.pendingEgress.forEach((function(e){i.egress(e)})),i.pendingEgress=[],i.pingInterval=setInterval((function(){i.logPingLatencyOp&&(--i.remainingPingFailures,a(!1)),i.remainingPingFailures>0&&i.hasBeenOpened&&i.lastPongTime<i.lastEgressTime&&(i.ws.send(e.pingPongMessage,(function(e){e&&(--i.remainingPingFailures,a(!1))})),i.logPingLatencyOp=new r.Operation({operationName:"Ping",success:!0}).start())}),3e4)})),this.ws.addEventListener("message",(function(t){i.logPingLatencyOp&&"string"==typeof t.data&&1===t.data.length&&t.data[0]===e.pingPongMessage?(a(!0),i.lastPongTime=Date.now()):o(t.data)})),this.ws.addEventListener("error",(function(t){i.errorMessage=t.message,e.logCountLimiter.log((function(){i.logOp.resourceId="OnError",i.logOp.resultDescription=i.errorMessage,i.logOp.success=!1,i.logOp.stop(),r.Log.info(594642308,r.LogCategory.CoreDefault,i.logOp)})),i.ws.close()})),this.ws.addEventListener("close",(function(t){e.logCountLimiter.log((function(){i.logOp.resourceId="OnClose",i.logOp.resultDescription="",i.logOp.success=!0,i.logOp.stop(),r.Log.info(594642309,r.LogCategory.CoreDefault,i.logOp)})),i.pingInterval&&(clearInterval(i.pingInterval),i.pingInterval=void 0),s(i.errorMessage)}))},e.prototype.egress=function(t){var o=this;this.lastEgressTime=Date.now(),this.hasBeenOpened?this.ws.send(t,(function(t){t&&!o.hadEgressError&&(o.hadEgressError=!0,e.logCountLimiter.log((function(){o.logOp.resourceId="OnFirstEgressError",o.logOp.resultDescription=t.message,o.logOp.success=!1,o.logOp.stop(),r.Log.info(594642310,r.LogCategory.CoreDefault,o.logOp)})))})):this.pendingEgress.push(t)},e.prototype.close=function(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=void 0),this.ws.close()},e.className="WebSocketWorker",e.logCountLimiter=new s.LogCountLimiter(e.className),e.pingPongMessage="~",e}();o.WebSocketWorker=i},{"../utils":43,"@augloop/logging/dist/src/client/logging":16,"isomorphic-ws":94}],54:[function(e,t,o){t.exports={name:"@augloop/runtime-client",version:"2.14.265",description:"Client runtime for augmentation loop",main:"./dist/src/index.js",types:"./dist/src/index.d.ts",dependencies:{"@augloop/interfaces":"2.14.251","@augloop/jsond":"2.14.122","@augloop/logging":"2.14.263","@augloop/schemas":"2.14.251","@augloop/session-protocol":"2.14.263","@augloop/tracelogger":"2.14.263","@augloop/types-core":"2.14.251","@augloop/types-signals":"2.14.251","core-js":"2.5.3","cross-fetch":"2.1.0","double-ended-queue":"2.1.0-0",eventemitter3:"3.1.2","http-status-enum":"1.0.2","isomorphic-ws":"4.0.1",ws:"5.1.1"},files:["dist/src"],author:"",license:"Microsoft"}},{}],55:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.IdentityProvider=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.LiveId=1]="LiveId",e[e.OrgId=2]="OrgId",e[e.ActiveDirectory=3]="ActiveDirectory",e[e.ADAL=4]="ADAL",e[e.SSPI=5]="SSPI",e[e.OAuth2=6]="OAuth2",e[e.Badger=7]="Badger"}(o.IdentityProvider||(o.IdentityProvider={}))},{}],56:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.WaitOnStrategy=void 0,function(e){e[e.All=0]="All",e[e.Any=1]="Any"}(o.WaitOnStrategy||(o.WaitOnStrategy={}))},{}],57:[function(e,t,o){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||t.hasOwnProperty(o)||n(t,e,o)};Object.defineProperty(o,"__esModule",{value:!0}),r(e("../authentication-schemas"),o),r(e("../builtin-lambda-schemas"),o);var s=e("../message-schema");Object.defineProperty(o,"ExceptionType",{enumerable:!0,get:function(){return s.ExceptionType}}),Object.defineProperty(o,"MessageType",{enumerable:!0,get:function(){return s.MessageType}}),r(e("../officeart-schemas"),o),r(e("../powerpoint-schemas"),o),r(e("../test-schemas"),o),r(e("../tiling-schemas"),o),r(e("../type-schema"),o)},{"../authentication-schemas":55,"../builtin-lambda-schemas":56,"../message-schema":58,"../officeart-schemas":59,"../powerpoint-schemas":60,"../test-schemas":61,"../tiling-schemas":62,"../type-schema":63}],58:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.ExceptionType=o.MessageType=void 0,function(e){e[e.Input=0]="Input",e[e.Exception=1]="Exception",e[e.WaitOn=2]="WaitOn",e[e.StopAndFilterWorkflow=3]="StopAndFilterWorkflow"}(o.MessageType||(o.MessageType={})),function(e){e[e.Unknown=0]="Unknown",e[e.NoOutput=1]="NoOutput",e[e.Authentication=2]="Authentication",e[e.JoinTimedOut=3]="JoinTimedOut",e[e.LambdaThrow=4]="LambdaThrow",e[e.LambdaErrorCallback=5]="LambdaErrorCallback"}(o.ExceptionType||(o.ExceptionType={}))},{}],59:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.Oart=void 0,function(e){!function(e){e[e.shape=0]="shape",e[e.groupShape=1]="groupShape",e[e.graphicFrame=2]="graphicFrame",e[e.connector=3]="connector",e[e.picture=4]="picture",e[e.ink=5]="ink"}(e.DrawingElementType||(e.DrawingElementType={}))}(o.Oart||(o.Oart={}))},{}],60:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.Ppt=void 0,function(e){!function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change"}(e.SlideTileEventType||(e.SlideTileEventType={}))}(o.Ppt||(o.Ppt={}))},{}],61:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.JobState=void 0,function(e){e[e.Submitted=0]="Submitted",e[e.Pending=1]="Pending",e[e.Running=2]="Running",e[e.Completed=3]="Completed",e[e.Failed=4]="Failed",e[e.Aborted=5]="Aborted"}(o.JobState||(o.JobState={}))},{}],62:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.Tiling=void 0,function(e){!function(e){e[e.Unknown=0]="Unknown",e[e.Text=1]="Text",e[e.Slide=2]="Slide"}(e.TileType||(e.TileType={})),function(e){e[e.Generic=0]="Generic",e[e.Title=1]="Title",e[e.SmartArt=2]="SmartArt",e[e.TableCell=3]="TableCell",e[e.TextBox=4]="TextBox",e[e.Notes=5]="Notes"}(e.TextTileType||(e.TextTileType={})),function(e){e[e.Undefined=0]="Undefined",e[e.Word=1]="Word",e[e.Phrase=2]="Phrase",e[e.Sentence=3]="Sentence",e[e.Paragraph=4]="Paragraph"}(e.TextTileElementUnit||(e.TextTileElementUnit={})),function(e){e[e.Undefined=0]="Undefined",e[e.Bullet=1]="Bullet",e[e.Numbered=2]="Numbered"}(e.ListType||(e.ListType={})),function(e){e[e.Undefined=0]="Undefined",e[e.AlphaLcParenBoth=1]="AlphaLcParenBoth",e[e.AlphaUcParenBoth=2]="AlphaUcParenBoth",e[e.AlphaLcParenR=3]="AlphaLcParenR",e[e.AlphaUcParenR=4]="AlphaUcParenR",e[e.AlphaLcPeriod=5]="AlphaLcPeriod",e[e.AlphaUcPeriod=6]="AlphaUcPeriod",e[e.ArabicParenBoth=7]="ArabicParenBoth",e[e.ArabicParenR=8]="ArabicParenR",e[e.ArabicPeriod=9]="ArabicPeriod",e[e.ArabicPlain=10]="ArabicPlain",e[e.RomanLcParenBoth=11]="RomanLcParenBoth",e[e.RomanUcParenBoth=12]="RomanUcParenBoth",e[e.RomanLcParenR=13]="RomanLcParenR",e[e.RomanUcParenR=14]="RomanUcParenR",e[e.RomanLcPeriod=15]="RomanLcPeriod",e[e.RomanUcPeriod=16]="RomanUcPeriod",e[e.CircleNumDbPlain=17]="CircleNumDbPlain",e[e.CircleNumWdBlackPlain=18]="CircleNumWdBlackPlain",e[e.CircleNumWdWhitePlain=19]="CircleNumWdWhitePlain",e[e.ArabicDbPeriod=20]="ArabicDbPeriod",e[e.ArabicDbPlain=21]="ArabicDbPlain",e[e.Ea1ChsPeriod=22]="Ea1ChsPeriod",e[e.Ea1ChsPlain=23]="Ea1ChsPlain",e[e.Ea1ChtPeriod=24]="Ea1ChtPeriod",e[e.Ea1ChtPlain=25]="Ea1ChtPlain",e[e.Ea1JpnChsDbPeriod=26]="Ea1JpnChsDbPeriod",e[e.Ea1JpnKorPlain=27]="Ea1JpnKorPlain",e[e.Ea1JpnKorPeriod=28]="Ea1JpnKorPeriod",e[e.Arabic1Minus=29]="Arabic1Minus",e[e.Arabic2Minus=30]="Arabic2Minus",e[e.Hebrew2Minus=31]="Hebrew2Minus",e[e.ThaiAlphaPeriod=32]="ThaiAlphaPeriod",e[e.ThaiAlphaParenR=33]="ThaiAlphaParenR",e[e.ThaiAlphaParenBoth=34]="ThaiAlphaParenBoth",e[e.ThaiNumPeriod=35]="ThaiNumPeriod",e[e.ThaiNumParenR=36]="ThaiNumParenR",e[e.ThaiNumParenBoth=37]="ThaiNumParenBoth",e[e.HindiAlphaPeriod=38]="HindiAlphaPeriod",e[e.HindiNumPeriod=39]="HindiNumPeriod",e[e.HindiNumParenR=40]="HindiNumParenR",e[e.HindiAlpha1Period=41]="HindiAlpha1Period"}(e.ListNumeration||(e.ListNumeration={})),function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change"}(e.TextTileEventType||(e.TextTileEventType={}))}(o.Tiling||(o.Tiling={}))},{}],63:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.TypeCategory=void 0,function(e){e[e.Undefined=0]="Undefined",e[e.Schema=1]="Schema",e[e.Boolean=2]="Boolean",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Buffer=5]="Buffer",e[e.Function=6]="Function"}(o.TypeCategory||(o.TypeCategory={}))},{}],64:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.TokenProvisionResponse=o.TokenProvisionMessage=o.AnnotationResultsMessage=o.SessionDeleteMessage=o.SyncResponse=o.MicroSyncMessage=o.SyncMessage=o.AnnotationReleaseResponse=o.AnnotationReleaseMessage=o.AnnotationResultStateMessage=o.AnnotationActivationResponse=o.AnnotationActivationMessage=o.CacheDumpRequestResponse=o.CacheDumpRequestMessage=o.SessionCloseMessage=o.SessionInitResponse=o.SessionInitMessage=o.TimeoutErrorResponse=o.ErrorResponse=o.Response=o.Message=void 0;var n=e("@augloop/types-core"),r=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Message"},e.getBaseTypes=function(){return[]},e}();o.Message=r;var s=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Response"},e.getBaseTypes=function(){return[]},e}();o.Response=s;var i=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_ErrorResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e}();o.ErrorResponse=i;var a=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TimeoutErrorResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_ErrorResponse","AugLoop_Session_Protocol_Response"]},e}();o.TimeoutErrorResponse=a;var c=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionInitMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e}();o.SessionInitMessage=c;var u=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionInitResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e}();o.SessionInitResponse=u;var l=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionCloseMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e}();o.SessionCloseMessage=l;var p=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_CacheDumpRequestMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e}();o.CacheDumpRequestMessage=p;var g=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_CacheDumpRequestResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e}();o.CacheDumpRequestResponse=g;var f=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationActivationMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e}();o.AnnotationActivationMessage=f;var h=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationActivationResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e}();o.AnnotationActivationResponse=h;var d=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationResultStateMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e}();o.AnnotationResultStateMessage=d;var m=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationReleaseMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e}();o.AnnotationReleaseMessage=m;var y=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationReleaseResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e}();o.AnnotationReleaseResponse=y;var v=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SyncMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e}();o.SyncMessage=v;var b=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_MicroSyncMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e}();o.MicroSyncMessage=b;var S=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SyncResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e}();o.SyncResponse=S;var T=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionDeleteMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e}();o.SessionDeleteMessage=T;var _=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationResultsMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_SyncMessage","AugLoop_Session_Protocol_Message"]},e}();o.AnnotationResultsMessage=_;var C=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TokenProvisionMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e}();o.TokenProvisionMessage=C;var w=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TokenProvisionResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e}();o.TokenProvisionResponse=w},{"@augloop/types-core":77}],65:[function(e,t,o){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||t.hasOwnProperty(o)||n(t,e,o)};Object.defineProperty(o,"__esModule",{value:!0}),r(e("./message-endpoint"),o),r(e("./messages"),o),r(e("./generated/messages.g"),o)},{"./generated/messages.g":64,"./message-endpoint":66,"./messages":67}],66:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.MessageEndpoint=o.extractMessageNameFromTypeName=o.ProcessMessageErrorReason=o.SendMessageErrorReason=void 0;var n,r,s=e("@augloop/logging/dist/src/client/logging"),i=e("@augloop/logging/dist/src/session-health-event"),a=e("@augloop/types-core"),c=e("./generated/messages.g"),u=e("sweep-cache");function l(e){for(var t,o=0,n=["AugLoop_Excel_Session_Protocol_","AugLoop_Powerpoint_Session_Protocol_","AugLoop_Session_Protocol_"];o<n.length;o++){var r=n[o];if(0===e.indexOf(r)){t=r;break}}if(!t)return"MalformedMessageName";var s=e.indexOf("Message",e.length-"Message".length)===e.length-"Message".length;return e.slice(t.length,s?-"Message".length:void 0)}!function(e){e.ClientDisconnected="Client disconnected.",e.UnsupportedSyncMessage="SyncMessages with seq = -1 are not supported anymore.",e.UnexpectedSeedMessage="Unexpected seed message",e.SyncMessageUnsupportedBatch="SyncMessage with unsupported batching."}(n=o.SendMessageErrorReason||(o.SendMessageErrorReason={})),function(e){e.ProvisionTokenValidationError="Token provision message didn't pass token validation."}(r=o.ProcessMessageErrorReason||(o.ProcessMessageErrorReason={})),o.extractMessageNameFromTypeName=l;var p=function(){function e(e){this.nextMessageId=1,this.pendingResponseCallbacks=new u.Cache({sweepInterval:5e3}),this.pendingMessageCallbacks=new u.Cache({sweepInterval:5e3}),this.messageCallbacks=new Map,this.messageIdPrefix=e,this.source="c"===e?i.SessionHealthSource.ClientRuntime:i.SessionHealthSource.Core,this.stats={sendMessageCount:0,sendMessageClientDisconnectedErrors:0,sendMessageErrors:0,sendMessageDurationMsMax:0,processMessageCount:0,processMessageProvisionTokenErrors:0,processMessageErrors:0,processMessageDurationMsMax:0}}return e.prototype.setClientMetadata=function(e){this.clientMetadata=e},e.prototype.setEgress=function(e){this.egress=e},e.prototype.ingress=function(e,t){var o=a.SchemaObject.getBaseTypesFor(e),n=a.SchemaObject.getTypeNameFor(e);n===c.Response.getTypeName()||o&&o.indexOf(c.Response.getTypeName())>=0?(this.processResponse(e),t()):this.processMessage(e,t),n===c.SessionCloseMessage.getTypeName()&&this.clearAllPendingResponses()},e.prototype.sendMessage=function(e,t,o,n){var r=this;void 0===n&&(n=0);var u=new i.SessionHealth({sessionHealthEventName:"SendMessage",source:this.source,reason:i.SessionHealthReason.Client,impact:this.source===i.SessionHealthSource.ClientRuntime?i.SessionHealthImpact.MissingInput:i.SessionHealthImpact.MissingOutput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv,resourceId:l(a.SchemaObject.getTypeNameFor(e)),dimension0:n.toString()}).start(),p=function(){if(u.setClientMetadata(r.clientMetadata),u.success)s.Log.info(590485084,s.LogCategory.CoreDefault,u.stop());else{var e="ErrorWithoutPendingResponse"===u.resultSignature||"ResponseCallbackException"===u.resultSignature||"We called into done callback"!==u.message;u.message=JSON.stringify({errorNotPropagatedToDoneCallback:e}),s.Log.error(590485085,s.LogCategory.CoreDefault,u.stop())}};if(e.messageId=""+this.messageIdPrefix+this.nextMessageId++,!o&&a.SchemaObject.getTypeNameFor(e)!==c.SessionCloseMessage.getTypeName()){var g=function(o,n){if(o?(u.success=!1,u.resultSignature="Error",u.resultDescription="Error for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+o.error):(u.resultSignature="Success",u.resultDescription="Sent "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId),t)try{u.message="We called into done callback",t(o,n)}catch(e){u.success=!1,u.resultSignature="ResponseCallbackException",u.resultDescription=e.message}r.pendingMessageCallbacks.del(e.messageId),p(),r.updateSendMessageStats(u.success,u.durationMs,o?new Error(o.error):void 0)};this.pendingResponseCallbacks.put(e.messageId,g,1e4,(function(){g(new c.TimeoutErrorResponse({error:"Timeout waiting for response"}),void 0)}))}this.egress(e,(function(t){if(t){var o=r.pendingResponseCallbacks.get(e.messageId);o?(r.pendingResponseCallbacks.del(e.messageId),o(new c.ErrorResponse({error:t.message}))):(u.success=!1,u.resultSignature="ErrorWithoutPendingResponse",u.resultDescription="Error for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+(null==t?void 0:t.message),p())}}))},e.prototype.onMessage=function(e,t){this.messageCallbacks.set(e,t)},e.prototype.getStats=function(){return this.stats},e.prototype.hasMessageCallback=function(e){return this.messageCallbacks.has(e)},e.prototype.cancelPendingResponseCallbacks=function(){var e=this;this.pendingResponseCallbacks.forEach((function(t,o){t&&(e.pendingResponseCallbacks.del(o),t(new c.ErrorResponse({error:"Cancelled"})))}))},e.prototype.clearAllPendingResponses=function(){if(0!=this.pendingResponseCallbacks.size()){var e=new s.Operation({operationName:"PurgePendingResponses",resultDescription:this.pendingResponseCallbacks.size.toString(),success:!0});s.Log.info(595855050,s.LogCategory.CoreDefault,e),this.pendingResponseCallbacks.clear()}},e.prototype.processMessage=function(e,t){var o=this,n=new i.SessionHealth({sessionHealthEventName:"ProcessMessage",source:this.source,reason:i.SessionHealthReason.Client,impact:this.source===i.SessionHealthSource.ClientRuntime?i.SessionHealthImpact.MissingOutput:i.SessionHealthImpact.MissingInput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv}).start(),r=function(){if(n.setClientMetadata(o.clientMetadata),n.success)s.Log.info(590485086,s.LogCategory.CoreDefault,n.stop());else{var e="UnsupportedMessage"===n.resourceId||"Timeout"===n.resultSignature||"OnResponseInvokedMoreThanOnce"===n.resultSignature||"MessageCallbackException"===n.resultSignature||"We called into messageCallback"!==n.message;n.message=JSON.stringify({errorHappenedOutsideRegisteredMessageCallback:e}),s.Log.error(590485087,s.LogCategory.CoreDefault,n.stop())}},u=this.messageCallbacks.get(a.SchemaObject.getTypeNameFor(e));u?n.resourceId=l(a.SchemaObject.getTypeNameFor(e)):u=function(t,o){n.resourceId="UnsupportedMessage",o(new c.ErrorResponse({error:"Message type "+a.SchemaObject.getTypeNameFor(e)+" is not supported"}))};this.pendingMessageCallbacks.put(e.messageId,void 0,1e4,(function(){n.success=!1,n.resultSignature="Timeout",n.resultDescription="Timeout processing message callback",r(),s.Log.error(595736336,s.LogCategory.CoreDefault,"Timeout processing "+n.resourceId),o.updateProcessMessageStats(!1,n.durationMs,new Error("timeout"))}));var p=!1;try{n.message="We called into messageCallback",u(e,(function(s,i){o.pendingMessageCallbacks.del(e.messageId),p?(n.success=!1,n.resultSignature="OnResponseInvokedMoreThanOnce",n.resultDescription="Invoked onResponse for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+" more than once"):s?(n.success=!1,n.resultSignature="Error",n.resultDescription="Error for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+s.error):(n.resultSignature="Success",n.resultDescription="Processed "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId),p=!0,r(),s&&!a.SchemaObject.matchesTypesFor(s,[c.ErrorResponse.getTypeName()])&&(s=new c.ErrorResponse({error:"Internal Server Error"})),o.updateProcessMessageStats(n.success,n.durationMs,s?new Error(s.error):void 0),s?(s.messageId=e.messageId,t(s)):i?(i.messageId=e.messageId,t(void 0,i)):t()}))}catch(o){this.pendingMessageCallbacks.del(e.messageId),n.success=!1,n.resultSignature="MessageCallbackException",n.resultDescription=o.message,r(),this.updateProcessMessageStats(!1,n.durationMs,o),t()}},e.prototype.processResponse=function(e){var t=new s.Operation({operationName:"ProcessResponse"});t.success=!0,t.setClientMetadata(this.clientMetadata),t.start();var o=this.pendingResponseCallbacks.get(e.messageId);o?(this.pendingResponseCallbacks.del(e.messageId),a.SchemaObject.matchesTypesFor(e,[c.ErrorResponse.getTypeName()])?o(e):o(void 0,e)):(t.resultSignature="NoPendingMessage",t.success=!1),t.stop(),s.Log.info(595855051,s.LogCategory.CoreDefault,t)},e.prototype.updateSendMessageStats=function(e,t,o){this.stats.sendMessageCount++,this.stats.sendMessageDurationMsMax=Math.max(t,this.stats.sendMessageDurationMsMax),e||o?e&&o&&s.Log.warn(592513158,s.LogCategory.CoreDefault,"Succeeded send message provided error object."):s.Log.warn(592513157,s.LogCategory.CoreDefault,"Failed send message did not provide error object."),e||(o&&o.message===n.ClientDisconnected?this.stats.sendMessageClientDisconnectedErrors++:this.stats.sendMessageErrors++)},e.prototype.updateProcessMessageStats=function(e,t,o){this.stats.processMessageCount++,this.stats.processMessageDurationMsMax=Math.max(t,this.stats.processMessageDurationMsMax),e||o?e&&o&&s.Log.warn(592513160,s.LogCategory.CoreDefault,"Succeeded process message provided error object."):s.Log.warn(592513159,s.LogCategory.CoreDefault,"Failed process message did not provide error object."),e||(o&&o.message===r.ProvisionTokenValidationError?this.stats.processMessageProvisionTokenErrors++:this.stats.processMessageErrors++)},e}();o.MessageEndpoint=p},{"./generated/messages.g":64,"@augloop/logging/dist/src/client/logging":16,"@augloop/logging/dist/src/session-health-event":22,"@augloop/types-core":77,"sweep-cache":69}],67:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.AnnotationResultState=o.currentProtocolVersion=void 0,o.currentProtocolVersion=2,function(e){e[e.Idle=0]="Idle",e[e.Pending=1]="Pending"}(o.AnnotationResultState||(o.AnnotationResultState={}))},{}],68:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.Cache=void 0;var n=function(){function e(e){if(this.cache=new Map,this.options=e||{sweepInterval:100},null!=this.options.idleDurationMs&&this.options.idleDurationMs<=0)throw new Error("Idle duration must be positive");if(this.interval=this.options.sweepInterval||100,this.interval<=0)throw new Error("Sweep interval must be a positive number")}return e.prototype.put=function(e,t,o,n,r){if(null==o||o<=0)throw new Error("Cache timeout must be a positive number");(null==r||r<=0)&&(r=this.options.idleDurationMs);var s={value:t,lastUsed:r?Date.now():void 0,expire:o+Date.now(),idleDurationMs:r,expireCallback:n};return this.cache.set(e,s),this.timeout||(this.timeout=setInterval(this.onInterval.bind(this),this.interval),this.timeout.unref&&this.timeout.unref()),t},e.prototype.del=function(e){var t=this.cache.delete(e);return 0===this.size()&&this.clear(),t},e.prototype.clear=function(){this.timeout&&(clearInterval(this.timeout),this.timeout=void 0),this.cache.clear()},e.prototype.get=function(e){var t=this.cache.get(e);if(t)return this.options.idleDurationMs&&(t.lastUsed=Date.now()),t.value},e.prototype.keys=function(){return this.cache.keys()},e.prototype.forEach=function(e){this.cache.forEach((function(t,o){e(t.value,o)}))},e.prototype.size=function(){return this.cache.size},e.prototype.updateExpireTime=function(e,t){return!!(this.cache.has(e)&&t>=0)&&(this.cache.get(e).expire=t+Date.now(),!0)},e.prototype.onInterval=function(){var e=this,t=Date.now();this.cache.forEach((function(o,n){if(o.idleDurationMs&&o.lastUsed<t-o.idleDurationMs)return e.del(n),void(e.options.idleCallback&&e.options.idleCallback(n,o.value));o.expire<t&&(e.del(n),o.expireCallback&&o.expireCallback(n,o.value))}))},e}();o.Cache=n},{}],69:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=e("./cache");Object.defineProperty(o,"Cache",{enumerable:!0,get:function(){return n.Cache}})},{"./cache":68}],70:[function(e,t,o){var n={util:{},roots:{default:{}}},r=(n.util,n.roots.default||(n.roots.default={}));r.OperationEvent=function(){function e(e){if(e)for(var t=Object.keys(e),o=0;o<t.length;++o)null!=e[t[o]]&&(this[t[o]]=e[t[o]])}return e.prototype.count=0,e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.durationMs=0,e.prototype.success=!1,e.prototype.resultDescription="",e.prototype.resultSignature="",e.prototype.operationName="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e}(),t.exports=r},{}],71:[function(e,t,o){var n={util:{},roots:{default:{}}},r=(n.util,n.roots.default||(n.roots.default={}));r.SessionHealthEvent=function(){function e(e){if(e)for(var t=Object.keys(e),o=0;o<t.length;++o)null!=e[t[o]]&&(this[t[o]]=e[t[o]])}return e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.sessionHealthEventName="",e.prototype.source="",e.prototype.reason="",e.prototype.reasonDependency="",e.prototype.impact="",e.prototype.success=!1,e.prototype.durationMs=0,e.prototype.count=0,e.prototype.message="",e.prototype.affectedWorkflows="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.resultDescription="",e.prototype.resultSignature="",e}(),t.exports=r},{}],72:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.AnnotationState=void 0,function(e){e[e.Undefined=0]="Undefined",e[e.Created=10]="Created",e[e.Sent=20]="Sent",e[e.Duplicated=30]="Duplicated",e[e.Seen=40]="Seen",e[e.Tried=50]="Tried",e[e.Kept=60]="Kept",e[e.Rejected=70]="Rejected"}(o.AnnotationState||(o.AnnotationState={}))},{}],73:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.BinaryClassificationAnnotation=o.Annotation=void 0;var n=e("./schema-object.g"),r=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Annotation"},e.getBaseTypes=function(){return[]},e}();o.Annotation=r;var s=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_BinaryClassificationAnnotation"},e.getBaseTypes=function(){return["AugLoop_Core_Annotation"]},e}();o.BinaryClassificationAnnotation=s},{"./schema-object.g":75}],74:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.DeltaUpdateOperation=o.VisibilityOperation=o.FocusOperation=o.PurgeOperation=o.DeleteOperation=o.UpdateOperation=o.UpdateAnnotationMetaDataOperation=o.MoveOperation=o.AddOperation=o.OperationWithSiblingContext=o.Operation=void 0;var n=e("./schema-object.g"),r=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Operation"},e.getBaseTypes=function(){return[]},e}();o.Operation=r;var s=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_OperationWithSiblingContext"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e}();o.OperationWithSiblingContext=s;var i=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_AddOperation"},e.getBaseTypes=function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]},e}();o.AddOperation=i;var a=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_MoveOperation"},e.getBaseTypes=function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]},e}();o.MoveOperation=a;var c=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UpdateAnnotationMetaDataOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e}();o.UpdateAnnotationMetaDataOperation=c;var u=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UpdateOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e}();o.UpdateOperation=u;var l=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DeleteOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e}();o.DeleteOperation=l;var p=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_PurgeOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e}();o.PurgeOperation=p;var g=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_FocusOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e}();o.FocusOperation=g;var f=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_VisibilityOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e}();o.VisibilityOperation=f;var h=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DeltaUpdateOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e}();o.DeltaUpdateOperation=h},{"./schema-object.g":75}],75:[function(e,t,o){"use strict";var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var n=Array(e),r=0;for(t=0;t<o;t++)for(var s=arguments[t],i=0,a=s.length;i<a;i++,r++)n[r]=s[i];return n};Object.defineProperty(o,"__esModule",{value:!0}),o.SchemaObject=void 0;var r=function(){function e(t){e.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_SchemaObject"},e.getBaseTypes=function(){return[]},e.getTypeNameFor=function(e){return e&&e.H_?e.H_.T_:void 0},e.getBaseTypesFor=function(e){return e&&e.H_&&e.H_.B_?e.H_.B_:[]},e.getAllTypesFor=function(t){var o=e.getTypeNameFor(t);return o?n([o],e.getBaseTypesFor(t)):[]},e.matchesTypesFor=function(t,o){if(!Array.isArray(o)||0===o.length)return!0;for(var n=e.getTypeNameFor(t),r=t&&t.H_&&t.H_.B_?t.H_.B_:void 0,s=0,i=o;s<i.length;s++){var a=i[s];if(a===n)return!0;if(r&&r.indexOf(a)>=0)return!0}return!1},e.assign=function(e,t,o){if(o)for(var n=0,r=Object.keys(o);n<r.length;n++){var s=r[n];t[s]=o[s]}return t.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},t},e}();o.SchemaObject=r},{}],76:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.ItemDelta=o.GridNeighborhoodContext=o.GridCell=o.Document=o.Session=o.TileGroup=o.Binary=o.Blob=void 0;var n=e("./schema-object.g"),r=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Blob"},e.getBaseTypes=function(){return[]},e}();o.Blob=r;var s=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Binary"},e.getBaseTypes=function(){return[]},e}();o.Binary=s;var i=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_TileGroup"},e.getBaseTypes=function(){return[]},e}();o.TileGroup=i;var a=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Session"},e.getBaseTypes=function(){return["AugLoop_Core_TileGroup"]},e}();o.Session=a;var c=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Document"},e.getBaseTypes=function(){return["AugLoop_Core_TileGroup"]},e}();o.Document=c;var u=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_GridCell"},e.getBaseTypes=function(){return[]},e}();o.GridCell=u;var l=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_GridNeighborhoodContext"},e.getBaseTypes=function(){return[]},e}();o.GridNeighborhoodContext=l;var p=function(){function e(t){n.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_ItemDelta"},e.getBaseTypes=function(){return[]},e}();o.ItemDelta=p},{"./schema-object.g":75}],77:[function(e,t,o){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||t.hasOwnProperty(o)||n(t,e,o)};Object.defineProperty(o,"__esModule",{value:!0}),r(e("./annotations"),o),r(e("./tiles"),o),r(e("./generated/annotations.g"),o),r(e("./generated/operations.g"),o),r(e("./generated/schema-object.g"),o),r(e("./generated/tiles.g"),o)},{"./annotations":72,"./generated/annotations.g":73,"./generated/operations.g":74,"./generated/schema-object.g":75,"./generated/tiles.g":76,"./tiles":78}],78:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.BlobRefType=void 0,function(e){e[e.None=0]="None",e[e.HttpsGetDownloadUrl=1]="HttpsGetDownloadUrl"}(o.BlobRefType||(o.BlobRefType={}))},{}],79:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.ConsoleLogger=void 0;var n=e("./buls/TraceLevel"),r=e("./buls/LogCategory"),s=function(){function e(){}return e.tagIntToString=function(t){return t<=e.maxNumericTag?t.toString():t>>24>=this.minOldSchemeHighByteValue?String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t):e.map.charAt(t>>24&63)+e.map.charAt(t>>18&63)+e.map.charAt(t>>12&63)+e.map.charAt(t>>6&63)+e.map.charAt(63&t)},e.getLogMessage=function(t,o,n){return"tag_"+e.tagIntToString(t)+" ["+r.LogCategory[o]+"] "+n},e.prototype.sendTraceTag=function(t,o,r,s){var i=console.log;switch(r){case n.TraceLevel.Error:i=console.error;break;case n.TraceLevel.Warning:i=console.warn;break;case n.TraceLevel.Info:i=console.info;break;case n.TraceLevel.Verbose:i=console.debug;break;case n.TraceLevel.Spam:default:i=console.log}try{i(e.getLogMessage(t,o,s))}catch(e){var a="undefined"!=typeof navigator?navigator:void 0;if(a&&!/rv:11.0/i.test(a.userAgent))throw e}},e.prototype.shipAssertTag=function(t,o,n,r){console.assert(n,e.getLogMessage(t,o,r))},e.prototype.debugAssertTag=function(e,t,o,n){this.shipAssertTag(e,t,o,n)},e.maxNumericTag=65535,e.minOldSchemeHighByteValue=36,e.map="abcdefghijklmnopqrstuvwxyz0123456789",e}();o.ConsoleLogger=s},{"./buls/LogCategory":81,"./buls/TraceLevel":83}],80:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.UnitTestLogger=void 0;var n=function(){function e(){}return e.prototype.sendTraceTag=function(){},e.prototype.shipAssertTag=function(){},e.prototype.debugAssertTag=function(){},e}();o.UnitTestLogger=n},{}],81:[function(e,t,o){"use strict";var n;Object.defineProperty(o,"__esModule",{value:!0}),o.LogCategory=void 0,o.LogCategory=n,function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS",e[e.msoulscat_ES_EWAJSGrid=1]="msoulscat_ES_EWAJSGrid",e[e.msoulscat_ES_EWAJSChart=6]="msoulscat_ES_EWAJSChart",e[e.msoulscat_Wac_WordViewer=301]="msoulscat_Wac_WordViewer",e[e.msoulscat_Wac_BrowserGeneral=306]="msoulscat_Wac_BrowserGeneral",e[e.msoulscat_Wac_TaskPane=320]="msoulscat_Wac_TaskPane",e[e.msoulscat_Wac_OneNoteGeneral=339]="msoulscat_Wac_OneNoteGeneral",e[e.msoulscat_Wac_Ribbon=340]="msoulscat_Wac_Ribbon",e[e.msoulscat_Wac_WopiPendingApplication=379]="msoulscat_Wac_WopiPendingApplication",e[e.msoulscat_Wac_Telemetry=383]="msoulscat_Wac_Telemetry",e[e.msoulscat_Wac_WacCatchUpActivities=391]="msoulscat_Wac_WacCatchUpActivities",e[e.msoulscat_Wac_OneNoteSync=395]="msoulscat_Wac_OneNoteSync",e[e.msoulscat_Wac_VisioApp=700]="msoulscat_Wac_VisioApp",e[e.msoulscat_OneNoteOnline_EditableCache=1601]="msoulscat_OneNoteOnline_EditableCache",e[e.msoulscat_Wac_PptShape=815]="msoulscat_Wac_PptShape",e[e.msoulscat_Wac_PptSession=817]="msoulscat_Wac_PptSession",e[e.msoulscat_Wac_VersionHistory=2300]="msoulscat_Wac_VersionHistory",e[e.msoulscat_Wac_WordPresence=302]="msoulscat_Wac_WordPresence"}(n||(o.LogCategory=n={}))},{}],82:[function(e,t,o){"use strict";var n;Object.defineProperty(o,"__esModule",{value:!0}),o.LogType=void 0,o.LogType=n,function(e){e[e.Trace=0]="Trace",e[e.Assert=1]="Assert"}(n||(o.LogType=n={}))},{}],83:[function(e,t,o){"use strict";var n;Object.defineProperty(o,"__esModule",{value:!0}),o.TraceLevel=void 0,o.TraceLevel=n,function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(n||(o.TraceLevel=n={}))},{}],84:[function(e,t,o){(function(t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.getUlsLogger=function(e,t){var o=new r.bUlsCache(e,t);return{sendTraceTag:function(e,t,n,r){return a(o,e,t,n,r)},shipAssertTag:function(e,t,n,r){n&&a(o,e,t,s.TraceLevel.Error,r)},debugAssertTag:function(){throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:o.flush,flushOnClose:o.flushOnClose}};var n=e("./LogType"),r=e("./bUlsCache"),s=e("./TraceLevel");var i="production"!==t.env.NODE_ENV?s.TraceLevel.Verbose:s.TraceLevel.Info;function a(e,t,o,r,s){if(!(r>i)){var a={timestamp:Date.now(),category:o,tag:t,level:r,type:n.LogType.Trace,message:s};e.handleTrace(a)}}}).call(this,e("_process"))},{"./LogType":82,"./TraceLevel":83,"./bUlsCache":85,_process:95}],85:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.bUlsCache=void 0;var n=e("./bUlsUploader"),r=e("./bUlsFormatter"),s=e("./TraceLevel"),i=function(){function e(t,o){var s=this;this.uploadId=0,this.logCache=[],this.timestampBase=Date.now(),this.userSessionId="00000000-0000-0000-0000-000000000000",this.flushOnClose=function(){s.triggerUpload(!1,!1)},this.flush=function(){s.triggerUploadAsync()},this.triggerUploadAsync=function(){window.setTimeout((function(){return s.triggerUpload(!0,!0)}),0)},this.triggerUpload=function(t,o){if(window.clearTimeout(s.timeoutId),s.logCache.length>0){s.uploadId+=1;var i=(0,r.formatForUpload)(s.logCache,s.userSessionId,s.uploadId,s.timestampBase);(0,n.uploadLogs)(i,s.remoteUrlEndpoint,o),s.logCache=[],s.timestampBase=Date.now()}t&&(s.timeoutId=window.setTimeout(s.triggerUploadAsync,e.uploadCadenceInMsSec))},this.userSessionId=t,this.remoteUrlEndpoint=o+"?usid="+t,window.setTimeout((function(){return s.triggerUpload(!0,!0)}),0)}return e.prototype.handleTrace=function(t){t.message.length>e.messageMaxChars&&(t.message=t.message.substr(0,e.messageMaxChars-e.trimmedMessage.length)+e.trimmedMessage),this.logCache.push(t),(this.logCache.length>e.uploadTriggerSize||t.level===s.TraceLevel.Error)&&this.triggerUploadAsync()},e.messageMaxChars=3072,e.uploadCadenceInMsSec=3e4,e.uploadTriggerSize=30,e.trimmedMessage="... [Trimmed]",e}();o.bUlsCache=i},{"./TraceLevel":83,"./bUlsFormatter":86,"./bUlsUploader":87}],86:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.formatForUpload=function(e,t,o,n){var r=e.map((function(e){return function(e,t){var o={};o.G=e.tag,o.T=e.timestamp-t,o.M=e.message,o.C=e.category;var n=1e3*e.type+e.level;return o.D=n,o}(e,n)})),s=function(e,t,o,n){var r={};return r.T=e,r.L=t,r.S=o,r.I=n,r.V=1,r}(n,r,t,o);return JSON.stringify(s)}},{}],87:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.uploadLogs=function(e,t,o){if(""===t)return;var n=new XMLHttpRequest;n.readyState!==XMLHttpRequest.UNSENT&&n.readyState!==XMLHttpRequest.DONE||(n.open("POST",t,o),n.send(e))}},{}],88:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.initializeLogger=function(e){if(!e)throw new Error("The 'logger' argument is missing");s.setLogger(e)},o.ULS=o.UlsLoggerWrapper=void 0;var n=e("./ConsoleLogger"),r=function(){function e(){this.externalLogger=new n.ConsoleLogger}return e.prototype.setLogger=function(e){this.externalLogger=e},e.prototype.sendTraceTag=function(e,t,o,n){this.externalLogger.sendTraceTag(e,t,o,n)},e.prototype.debugAssertTag=function(e,t,o,n){this.externalLogger.debugAssertTag(e,t,o,n)},e.prototype.shipAssertTag=function(e,t,o,n){this.externalLogger.shipAssertTag(e,t,o,n)},e}();o.UlsLoggerWrapper=r;var s=new r;o.ULS=s},{"./ConsoleLogger":79}],89:[function(e,t,o){var n=function(e){function t(){this.fetch=!1}return t.prototype=e,new t}("undefined"!=typeof self?self:this);(function(e){!function(e){if(!e.fetch){var t="URLSearchParams"in e,o="Symbol"in e&&"iterator"in Symbol,n="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),r="FormData"in e,s="ArrayBuffer"in e;if(s)var i=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=function(e){return e&&DataView.prototype.isPrototypeOf(e)},c=ArrayBuffer.isView||function(e){return e&&i.indexOf(Object.prototype.toString.call(e))>-1};h.prototype.append=function(e,t){e=p(e),t=g(t);var o=this.map[e];this.map[e]=o?o+","+t:t},h.prototype.delete=function(e){delete this.map[p(e)]},h.prototype.get=function(e){return e=p(e),this.has(e)?this.map[e]:null},h.prototype.has=function(e){return this.map.hasOwnProperty(p(e))},h.prototype.set=function(e,t){this.map[p(e)]=g(t)},h.prototype.forEach=function(e,t){for(var o in this.map)this.map.hasOwnProperty(o)&&e.call(t,this.map[o],o,this)},h.prototype.keys=function(){var e=[];return this.forEach((function(t,o){e.push(o)})),f(e)},h.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),f(e)},h.prototype.entries=function(){var e=[];return this.forEach((function(t,o){e.push([o,t])})),f(e)},o&&(h.prototype[Symbol.iterator]=h.prototype.entries);var u=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];S.prototype.clone=function(){return new S(this,{body:this._bodyInit})},b.call(S.prototype),b.call(_.prototype),_.prototype.clone=function(){return new _(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},_.error=function(){var e=new _(null,{status:0,statusText:""});return e.type="error",e};var l=[301,302,303,307,308];_.redirect=function(e,t){if(-1===l.indexOf(t))throw new RangeError("Invalid status code");return new _(null,{status:t,headers:{location:e}})},e.Headers=h,e.Request=S,e.Response=_,e.fetch=function(e,t){return new Promise((function(o,r){var s=new S(e,t),i=new XMLHttpRequest;i.onload=function(){var e,t,n={status:i.status,statusText:i.statusText,headers:(e=i.getAllResponseHeaders()||"",t=new h,e.split(/\r?\n/).forEach((function(e){var o=e.split(":"),n=o.shift().trim();if(n){var r=o.join(":").trim();t.append(n,r)}})),t)};n.url="responseURL"in i?i.responseURL:n.headers.get("X-Request-URL");var r="response"in i?i.response:i.responseText;o(new _(r,n))},i.onerror=function(){r(new TypeError("Network request failed"))},i.ontimeout=function(){r(new TypeError("Network request failed"))},i.open(s.method,s.url,!0),"include"===s.credentials&&(i.withCredentials=!0),"responseType"in i&&n&&(i.responseType="blob"),s.headers.forEach((function(e,t){i.setRequestHeader(t,e)})),i.send(void 0===s._bodyInit?null:s._bodyInit)}))},e.fetch.polyfill=!0}function p(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function g(e){return"string"!=typeof e&&(e=String(e)),e}function f(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return o&&(t[Symbol.iterator]=function(){return t}),t}function h(e){this.map={},e instanceof h?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function d(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function m(e){return new Promise((function(t,o){e.onload=function(){t(e.result)},e.onerror=function(){o(e.error)}}))}function y(e){var t=new FileReader,o=m(t);return t.readAsArrayBuffer(e),o}function v(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(n&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(r&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(s&&n&&a(e))this._bodyArrayBuffer=v(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!s||!ArrayBuffer.prototype.isPrototypeOf(e)&&!c(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=v(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n&&(this.blob=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var e,t,o,n=d(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,o=m(t),t.readAsText(e),o;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),o=new Array(t.length),n=0;n<t.length;n++)o[n]=String.fromCharCode(t[n]);return o.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(T)}),this.json=function(){return this.text().then(JSON.parse)},this}function S(e,t){var o,n,r=(t=t||{}).body;if(e instanceof S){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new h(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new h(t.headers)),this.method=(o=t.method||this.method||"GET",n=o.toUpperCase(),u.indexOf(n)>-1?n:o),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function T(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var o=e.split("="),n=o.shift().replace(/\+/g," "),r=o.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(r))}})),t}function _(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new h(t.headers),this.url=t.url||"",this._initBody(e)}}(void 0!==e?e:this)}).call(n,void 0);var r=n.fetch;r.Response=n.Response,r.Request=n.Request,r.Headers=n.Headers;"object"==typeof t&&t.exports&&(t.exports=r)},{}],90:[function(e,t,o){"use strict";function n(e){if(this._capacity=s(e),this._length=0,this._front=0,r(e)){for(var t=e.length,o=0;o<t;++o)this[o]=e[o];this._length=t}}n.prototype.toArray=function(){for(var e=this._length,t=new Array(e),o=this._front,n=this._capacity,r=0;r<e;++r)t[r]=this[o+r&n-1];return t},n.prototype.push=function(e){var t=arguments.length,o=this._length;if(t>1){var n=this._capacity;if(o+t>n){for(var r=0;r<t;++r){this._checkCapacity(o+1),this[s=this._front+o&this._capacity-1]=arguments[r],o++,this._length=o}return o}for(var s=this._front,r=0;r<t;++r)this[s+o&n-1]=arguments[r],s++;return this._length=o+t,o+t}return 0===t?o:(this._checkCapacity(o+1),this[r=this._front+o&this._capacity-1]=e,this._length=o+1,o+1)},n.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,o=this[t];return this[t]=void 0,this._length=e-1,o}},n.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,o=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,o}},n.prototype.unshift=function(e){var t=this._length,o=arguments.length;if(o>1){if(t+o>(r=this._capacity)){for(var n=o-1;n>=0;n--){this._checkCapacity(t+1);var r=this._capacity;this[i=(this._front-1&r-1^r)-r]=arguments[n],t++,this._length=t,this._front=i}return t}var s=this._front;for(n=o-1;n>=0;n--){var i;this[i=(s-1&r-1^r)-r]=arguments[n],s=i}return this._front=s,this._length=t+o,t+o}if(0===o)return t;this._checkCapacity(t+1);r=this._capacity;return this[n=(this._front-1&r-1^r)-r]=e,this._length=t+1,this._front=n,t+1},n.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},n.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},n.prototype.get=function(e){var t=e;if(t===(0|t)){var o=this._length;if(t<0&&(t+=o),!(t<0||t>=o))return this[this._front+t&this._capacity-1]}},n.prototype.isEmpty=function(){return 0===this._length},n.prototype.clear=function(){for(var e=this._length,t=this._front,o=this._capacity,n=0;n<e;++n)this[t+n&o-1]=void 0;this._length=0,this._front=0},n.prototype.toString=function(){return this.toArray().toString()},n.prototype.valueOf=n.prototype.toString,n.prototype.removeFront=n.prototype.shift,n.prototype.removeBack=n.prototype.pop,n.prototype.insertFront=n.prototype.unshift,n.prototype.insertBack=n.prototype.push,n.prototype.enqueue=n.prototype.push,n.prototype.dequeue=n.prototype.shift,n.prototype.toJSON=n.prototype.toArray,Object.defineProperty(n.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),n.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(s(1.5*this._capacity+16))},n.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var o=this._front,n=this._length;o+n>t&&function(e,t,o,n,r){for(var s=0;s<r;++s)o[s+n]=e[s+t],e[s+t]=void 0}(this,0,this,t,o+n&t-1)};var r=Array.isArray;function s(e){if("number"!=typeof e){if(!r(e))return 16;e=e.length}return t=Math.min(Math.max(16,e),1073741824),t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16);var t}t.exports=n},{}],91:[function(e,t,o){"use strict";var n=Object.prototype.hasOwnProperty,r="~";function s(){}function i(e,t,o){this.fn=e,this.context=t,this.once=o||!1}function a(e,t,o,n,s){if("function"!=typeof o)throw new TypeError("The listener must be a function");var a=new i(o,n||e,s),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function u(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(r=!1)),u.prototype.eventNames=function(){var e,t,o=[];if(0===this._eventsCount)return o;for(t in e=this._events)n.call(e,t)&&o.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},u.prototype.listeners=function(e){var t=r?r+e:e,o=this._events[t];if(!o)return[];if(o.fn)return[o.fn];for(var n=0,s=o.length,i=new Array(s);n<s;n++)i[n]=o[n].fn;return i},u.prototype.listenerCount=function(e){var t=r?r+e:e,o=this._events[t];return o?o.fn?1:o.length:0},u.prototype.emit=function(e,t,o,n,s,i){var a=r?r+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],p=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),p){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,o),!0;case 4:return l.fn.call(l.context,t,o,n),!0;case 5:return l.fn.call(l.context,t,o,n,s),!0;case 6:return l.fn.call(l.context,t,o,n,s,i),!0}for(u=1,c=new Array(p-1);u<p;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var g,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),p){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,o);break;case 4:l[u].fn.call(l[u].context,t,o,n);break;default:if(!c)for(g=1,c=new Array(p-1);g<p;g++)c[g-1]=arguments[g];l[u].fn.apply(l[u].context,c)}}return!0},u.prototype.on=function(e,t,o){return a(this,e,t,o,!1)},u.prototype.once=function(e,t,o){return a(this,e,t,o,!0)},u.prototype.removeListener=function(e,t,o,n){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return c(this,s),this;var i=this._events[s];if(i.fn)i.fn!==t||n&&!i.once||o&&i.context!==o||c(this,s);else{for(var a=0,u=[],l=i.length;a<l;a++)(i[a].fn!==t||n&&!i[a].once||o&&i[a].context!==o)&&u.push(i[a]);u.length?this._events[s]=1===u.length?u[0]:u:c(this,s)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&c(this,t)):(this._events=new s,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,void 0!==t&&(t.exports=u)},{}],92:[function(e,t,o){"use strict";t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var o,n="boolean"==typeof t.cycles&&t.cycles,r=t.cmp&&(o=t.cmp,function(e){return function(t,n){var r={key:t,value:e[t]},s={key:n,value:e[n]};return o(r,s)}}),s=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var o,i;if(Array.isArray(t)){for(i="[",o=0;o<t.length;o++)o&&(i+=","),i+=e(t[o])||"null";return i+"]"}if(null===t)return"null";if(-1!==s.indexOf(t)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=s.push(t)-1,c=Object.keys(t).sort(r&&r(t));for(i="",o=0;o<c.length;o++){var u=c[o],l=e(t[u]);l&&(i&&(i+=","),i+=JSON.stringify(u)+":"+l)}return s.splice(a,1),"{"+i+"}"}}(e)}},{}],93:[function(e,t,o){(function(e){!function(e){function t(e){if("utf-8"!==(e=void 0===e?"utf-8":e))throw new RangeError("Failed to construct 'TextEncoder': The encoding label provided ('"+e+"') is invalid.")}function o(e,t){if(t=void 0===t?{fatal:!1}:t,"utf-8"!==(e=void 0===e?"utf-8":e))throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+e+"') is invalid.");if(t.fatal)throw Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}if(e.TextEncoder&&e.TextDecoder)return!1;Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to encode: the 'stream' option is unsupported.");t=0;for(var o=e.length,n=0,r=Math.max(32,o+(o>>1)+7),s=new Uint8Array(r>>3<<3);t<o;){var i=e.charCodeAt(t++);if(55296<=i&&56319>=i){if(t<o){var a=e.charCodeAt(t);56320==(64512&a)&&(++t,i=((1023&i)<<10)+(1023&a)+65536)}if(55296<=i&&56319>=i)continue}if(n+4>s.length&&(r+=8,r=(r*=1+t/e.length*2)>>3<<3,(a=new Uint8Array(r)).set(s),s=a),0==(4294967168&i))s[n++]=i;else{if(0==(4294965248&i))s[n++]=i>>6&31|192;else if(0==(4294901760&i))s[n++]=i>>12&15|224,s[n++]=i>>6&63|128;else{if(0!=(4292870144&i))continue;s[n++]=i>>18&7|240,s[n++]=i>>12&63|128,s[n++]=i>>6&63|128}s[n++]=63&i|128}}return s.slice(0,n)},Object.defineProperty(o.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(o.prototype,"fatal",{value:!1}),Object.defineProperty(o.prototype,"ignoreBOM",{value:!1}),o.prototype.decode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to decode: the 'stream' option is unsupported.");t=0;for(var o=(e=new Uint8Array(e)).length,n=[];t<o;){var r=e[t++];if(0===r)break;if(0==(128&r))n.push(r);else if(192==(224&r)){var s=63&e[t++];n.push((31&r)<<6|s)}else if(224==(240&r)){s=63&e[t++];var i=63&e[t++];n.push((31&r)<<12|s<<6|i)}else if(240==(248&r)){65535<(r=(7&r)<<18|(s=63&e[t++])<<12|(i=63&e[t++])<<6|63&e[t++])&&(r-=65536,n.push(r>>>10&1023|55296),r=56320|1023&r),n.push(r)}}return String.fromCharCode.apply(null,n)},e.TextEncoder=t,e.TextDecoder=o}("undefined"!=typeof window?window:void 0!==e?e:this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],94:[function(e,t,o){(function(e){var o=null;"undefined"!=typeof WebSocket?o=WebSocket:"undefined"!=typeof MozWebSocket?o=MozWebSocket:void 0!==e?o=e.WebSocket||e.MozWebSocket:"undefined"!=typeof window?o=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(o=self.WebSocket||self.MozWebSocket),t.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],95:[function(e,t,o){var n,r,s=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var u,l=[],p=!1,g=-1;function f(){p&&u&&(p=!1,u.length?l=u.concat(l):g=-1,l.length&&h())}function h(){if(!p){var e=c(f);p=!0;for(var t=l.length;t;){for(u=l,l=[];++g<t;)u&&u[g].run();g=-1,t=l.length}u=null,p=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];l.push(new d(e,t)),1!==l.length||p||c(h)},d.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}]},{},[25])(25)}));
//# sourceMappingURL=al.min.js.map
